
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>chipsec.hal.uefi_common &#8212; CHIPSEC  documentation</title>
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/classic.css" type="text/css" />
    
    <script id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    
    <link rel="shortcut icon" href="../../../_static/chipsec_favicon.jpg"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">CHIPSEC  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" accesskey="U">Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">chipsec.hal.uefi_common</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for chipsec.hal.uefi_common</h1><div class="highlight"><pre>
<span></span><span class="c1">#CHIPSEC: Platform Security Assessment Framework</span>
<span class="c1">#Copyright (c) 2010-2021, Intel Corporation</span>
<span class="c1">#</span>
<span class="c1">#This program is free software; you can redistribute it and/or</span>
<span class="c1">#modify it under the terms of the GNU General Public License</span>
<span class="c1">#as published by the Free Software Foundation; Version 2.</span>
<span class="c1">#</span>
<span class="c1">#This program is distributed in the hope that it will be useful,</span>
<span class="c1">#but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="c1">#MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="c1">#GNU General Public License for more details.</span>
<span class="c1">#</span>
<span class="c1">#You should have received a copy of the GNU General Public License</span>
<span class="c1">#along with this program; if not, write to the Free Software</span>
<span class="c1">#Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.</span>
<span class="c1">#</span>
<span class="c1">#Contact information:</span>
<span class="c1">#chipsec@intel.com</span>
<span class="c1">#</span>


<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Common UEFI/EFI functionality including UEFI variables, Firmware Volumes, Secure Boot variables, S3 boot-script, UEFI tables, etc.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">struct</span>
<span class="kn">import</span> <span class="nn">codecs</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">namedtuple</span>
<span class="kn">from</span> <span class="nn">uuid</span> <span class="kn">import</span> <span class="n">UUID</span>

<span class="kn">from</span> <span class="nn">chipsec.file</span> <span class="kn">import</span> <span class="n">read_file</span><span class="p">,</span> <span class="n">write_file</span>
<span class="kn">from</span> <span class="nn">chipsec.logger</span> <span class="kn">import</span> <span class="n">logger</span><span class="p">,</span> <span class="n">dump_buffer</span><span class="p">,</span> <span class="n">dump_buffer_bytes</span>
<span class="kn">from</span> <span class="nn">chipsec.defines</span> <span class="kn">import</span> <span class="n">bytestostring</span>

<span class="c1">#from chipsec.helper.oshelper import helper</span>


<span class="c1">################################################################################################</span>
<span class="c1">#</span>
<span class="c1"># EFI Variable and Variable Store Defines</span>
<span class="c1">#</span>
<span class="c1">################################################################################################</span>

<span class="c1"># UDK2010.SR1\MdeModulePkg\Include\Guid\VariableFormat.h</span>
<span class="c1">#</span>
<span class="c1"># Variable data start flag.</span>
<span class="c1">#</span>
<span class="n">VARIABLE_DATA</span>              <span class="o">=</span> <span class="mh">0x55aa</span>
<span class="n">VARIABLE_DATA_SIGNATURE</span>    <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;=H&#39;</span><span class="p">,</span> <span class="n">VARIABLE_DATA</span> <span class="p">)</span>


<span class="c1">#</span>
<span class="c1"># Variable Attributes</span>
<span class="c1">#</span>
<span class="n">EFI_VARIABLE_NON_VOLATILE</span>                          <span class="o">=</span> <span class="mh">0x00000001</span> <span class="c1"># Variable is non volatile</span>
<span class="n">EFI_VARIABLE_BOOTSERVICE_ACCESS</span>                    <span class="o">=</span> <span class="mh">0x00000002</span> <span class="c1"># Variable is boot time accessible</span>
<span class="n">EFI_VARIABLE_RUNTIME_ACCESS</span>                        <span class="o">=</span> <span class="mh">0x00000004</span> <span class="c1"># Variable is run-time accessible</span>
<span class="n">EFI_VARIABLE_HARDWARE_ERROR_RECORD</span>                 <span class="o">=</span> <span class="mh">0x00000008</span> <span class="c1">#</span>
<span class="n">EFI_VARIABLE_AUTHENTICATED_WRITE_ACCESS</span>            <span class="o">=</span> <span class="mh">0x00000010</span> <span class="c1"># Variable is authenticated</span>
<span class="n">EFI_VARIABLE_TIME_BASED_AUTHENTICATED_WRITE_ACCESS</span> <span class="o">=</span> <span class="mh">0x00000020</span> <span class="c1"># Variable is time based authenticated</span>
<span class="n">EFI_VARIABLE_APPEND_WRITE</span>                          <span class="o">=</span> <span class="mh">0x00000040</span> <span class="c1"># Variable allows append</span>
<span class="n">UEFI23_1_AUTHENTICATED_VARIABLE_ATTRIBUTES</span>         <span class="o">=</span> <span class="p">(</span><span class="n">EFI_VARIABLE_AUTHENTICATED_WRITE_ACCESS</span> <span class="o">|</span> <span class="n">EFI_VARIABLE_TIME_BASED_AUTHENTICATED_WRITE_ACCESS</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">IS_VARIABLE_ATTRIBUTE</span><span class="p">(</span><span class="n">_c</span><span class="p">,</span> <span class="n">_Mask</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span> <span class="p">(</span><span class="n">_c</span> <span class="o">&amp;</span> <span class="n">_Mask</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span> <span class="p">)</span>

<span class="k">def</span> <span class="nf">IS_EFI_VARIABLE_AUTHENTICATED</span><span class="p">(</span> <span class="n">attr</span> <span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span> <span class="n">IS_VARIABLE_ATTRIBUTE</span><span class="p">(</span> <span class="n">attr</span><span class="p">,</span> <span class="n">EFI_VARIABLE_AUTHENTICATED_WRITE_ACCESS</span> <span class="p">)</span> <span class="ow">or</span> <span class="n">IS_VARIABLE_ATTRIBUTE</span><span class="p">(</span> <span class="n">attr</span><span class="p">,</span> <span class="n">EFI_VARIABLE_TIME_BASED_AUTHENTICATED_WRITE_ACCESS</span> <span class="p">)</span> <span class="p">)</span>

<span class="n">MAX_VARIABLE_SIZE</span> <span class="o">=</span> <span class="mi">1024</span>
<span class="n">MAX_NVRAM_SIZE</span>    <span class="o">=</span> <span class="mi">1024</span> <span class="o">*</span><span class="mi">1024</span>

<span class="k">def</span> <span class="nf">get_nvar_name</span><span class="p">(</span><span class="n">nvram</span><span class="p">,</span> <span class="n">name_offset</span><span class="p">,</span> <span class="n">isAscii</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">isAscii</span><span class="p">:</span>
        <span class="n">nend</span> <span class="o">=</span> <span class="n">nvram</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x00</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">name_offset</span><span class="p">)</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">nvram</span><span class="p">[</span><span class="n">name_offset</span><span class="p">:</span><span class="n">nend</span><span class="p">]</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;latin1&#39;</span><span class="p">)</span>
        <span class="n">name_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">name_size</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">nend</span> <span class="o">=</span> <span class="n">nvram</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x00\x00</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">name_offset</span><span class="p">)</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">nvram</span><span class="p">[</span><span class="n">name_offset</span><span class="p">:</span><span class="n">nend</span><span class="p">]</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-16le&#39;</span><span class="p">)</span>
        <span class="n">name_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">name_size</span><span class="p">)</span>


<span class="n">VARIABLE_SIGNATURE_VSS</span> <span class="o">=</span> <span class="n">VARIABLE_DATA_SIGNATURE</span>



<span class="n">VARIABLE_STORE_FV_GUID</span>   <span class="o">=</span> <span class="n">UUID</span><span class="p">(</span><span class="s1">&#39;FFF12B8D-7696-4C8B-A985-2747075B4F50&#39;</span><span class="p">)</span>


<span class="c1">################################################################################################</span>
<span class="c1">#</span>
<span class="c1"># Misc Defines</span>
<span class="c1">#</span>
<span class="c1">################################################################################################</span>

<span class="c1">#</span>
<span class="c1"># Status codes</span>
<span class="c1"># edk2: MdePkg/Include/Base.h</span>
<span class="c1">#</span>

<span class="c1"># @TODO</span>
<span class="c1">#define ENCODE_ERROR(StatusCode)     ((RETURN_STATUS)(MAX_BIT | (StatusCode)))</span>
<span class="c1">#define ENCODE_WARNING(a)            (a)</span>

<span class="k">class</span> <span class="nc">StatusCode</span><span class="p">:</span>
    <span class="n">EFI_SUCCESS</span>              <span class="o">=</span> <span class="mi">0</span>
    <span class="n">EFI_LOAD_ERROR</span>           <span class="o">=</span> <span class="mi">1</span>
    <span class="n">EFI_INVALID_PARAMETER</span>    <span class="o">=</span> <span class="mi">2</span>
    <span class="n">EFI_UNSUPPORTED</span>          <span class="o">=</span> <span class="mi">3</span>
    <span class="n">EFI_BAD_BUFFER_SIZE</span>      <span class="o">=</span> <span class="mi">4</span>
    <span class="n">EFI_BUFFER_TOO_SMALL</span>     <span class="o">=</span> <span class="mi">5</span>
    <span class="n">EFI_NOT_READY</span>            <span class="o">=</span> <span class="mi">6</span>
    <span class="n">EFI_DEVICE_ERROR</span>         <span class="o">=</span> <span class="mi">7</span>
    <span class="n">EFI_WRITE_PROTECTED</span>      <span class="o">=</span> <span class="mi">8</span>
    <span class="n">EFI_OUT_OF_RESOURCES</span>     <span class="o">=</span> <span class="mi">9</span>
    <span class="n">EFI_VOLUME_CORRUPTED</span>     <span class="o">=</span> <span class="mi">10</span>
    <span class="n">EFI_VOLUME_FULL</span>          <span class="o">=</span> <span class="mi">11</span>
    <span class="n">EFI_NO_MEDIA</span>             <span class="o">=</span> <span class="mi">12</span>
    <span class="n">EFI_MEDIA_CHANGED</span>        <span class="o">=</span> <span class="mi">13</span>
    <span class="n">EFI_NOT_FOUND</span>            <span class="o">=</span> <span class="mi">14</span>
    <span class="n">EFI_ACCESS_DENIED</span>        <span class="o">=</span> <span class="mi">15</span>
    <span class="n">EFI_NO_RESPONSE</span>          <span class="o">=</span> <span class="mi">16</span>
    <span class="n">EFI_NO_MAPPING</span>           <span class="o">=</span> <span class="mi">17</span>
    <span class="n">EFI_TIMEOUT</span>              <span class="o">=</span> <span class="mi">18</span>
    <span class="n">EFI_NOT_STARTED</span>          <span class="o">=</span> <span class="mi">19</span>
    <span class="n">EFI_ALREADY_STARTED</span>      <span class="o">=</span> <span class="mi">20</span>
    <span class="n">EFI_ABORTED</span>              <span class="o">=</span> <span class="mi">21</span>
    <span class="n">EFI_ICMP_ERROR</span>           <span class="o">=</span> <span class="mi">22</span>
    <span class="n">EFI_TFTP_ERROR</span>           <span class="o">=</span> <span class="mi">23</span>
    <span class="n">EFI_PROTOCOL_ERROR</span>       <span class="o">=</span> <span class="mi">24</span>
    <span class="n">EFI_INCOMPATIBLE_VERSION</span> <span class="o">=</span> <span class="mi">25</span>
    <span class="n">EFI_SECURITY_VIOLATION</span>   <span class="o">=</span> <span class="mi">26</span>
    <span class="n">EFI_CRC_ERROR</span>            <span class="o">=</span> <span class="mi">27</span>
    <span class="n">EFI_END_OF_MEDIA</span>         <span class="o">=</span> <span class="mi">28</span>
    <span class="n">EFI_END_OF_FILE</span>          <span class="o">=</span> <span class="mi">31</span>
    <span class="n">EFI_INVALID_LANGUAGE</span>     <span class="o">=</span> <span class="mi">32</span>
    <span class="n">EFI_COMPROMISED_DATA</span>     <span class="o">=</span> <span class="mi">33</span>
    <span class="n">EFI_HTTP_ERROR</span>           <span class="o">=</span> <span class="mi">35</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  EFI_WARN_UNKNOWN_GLYPH    = 1</span>
<span class="sd">  EFI_WARN_DELETE_FAILURE   = 2</span>
<span class="sd">  EFI_WARN_WRITE_FAILURE    = 3</span>
<span class="sd">  EFI_WARN_BUFFER_TOO_SMALL = 4</span>
<span class="sd">  EFI_WARN_STALE_DATA       = 5</span>
<span class="sd">  EFI_WARN_FILE_SYSTEM      = 6</span>
<span class="sd">  &#39;&#39;&#39;</span>

<span class="n">EFI_STATUS_DICT</span> <span class="o">=</span> <span class="p">{</span>
  <span class="n">StatusCode</span><span class="o">.</span><span class="n">EFI_SUCCESS</span><span class="p">:</span> <span class="s2">&quot;EFI_SUCCESS&quot;</span><span class="p">,</span>
  <span class="n">StatusCode</span><span class="o">.</span><span class="n">EFI_LOAD_ERROR</span><span class="p">:</span> <span class="s2">&quot;EFI_LOAD_ERROR&quot;</span><span class="p">,</span>
  <span class="n">StatusCode</span><span class="o">.</span><span class="n">EFI_INVALID_PARAMETER</span><span class="p">:</span> <span class="s2">&quot;EFI_INVALID_PARAMETER&quot;</span><span class="p">,</span>
  <span class="n">StatusCode</span><span class="o">.</span><span class="n">EFI_UNSUPPORTED</span><span class="p">:</span> <span class="s2">&quot;EFI_UNSUPPORTED&quot;</span><span class="p">,</span>
  <span class="n">StatusCode</span><span class="o">.</span><span class="n">EFI_BAD_BUFFER_SIZE</span><span class="p">:</span> <span class="s2">&quot;EFI_BAD_BUFFER_SIZE&quot;</span><span class="p">,</span>
  <span class="n">StatusCode</span><span class="o">.</span><span class="n">EFI_BUFFER_TOO_SMALL</span><span class="p">:</span> <span class="s2">&quot;EFI_BUFFER_TOO_SMALL&quot;</span><span class="p">,</span>
  <span class="n">StatusCode</span><span class="o">.</span><span class="n">EFI_NOT_READY</span><span class="p">:</span> <span class="s2">&quot;EFI_NOT_READY&quot;</span><span class="p">,</span>
  <span class="n">StatusCode</span><span class="o">.</span><span class="n">EFI_DEVICE_ERROR</span><span class="p">:</span> <span class="s2">&quot;EFI_DEVICE_ERROR&quot;</span><span class="p">,</span>
  <span class="n">StatusCode</span><span class="o">.</span><span class="n">EFI_WRITE_PROTECTED</span><span class="p">:</span> <span class="s2">&quot;EFI_WRITE_PROTECTED&quot;</span><span class="p">,</span>
  <span class="n">StatusCode</span><span class="o">.</span><span class="n">EFI_OUT_OF_RESOURCES</span><span class="p">:</span> <span class="s2">&quot;EFI_OUT_OF_RESOURCES&quot;</span><span class="p">,</span>
  <span class="n">StatusCode</span><span class="o">.</span><span class="n">EFI_VOLUME_CORRUPTED</span><span class="p">:</span> <span class="s2">&quot;EFI_VOLUME_CORRUPTED&quot;</span><span class="p">,</span>
  <span class="n">StatusCode</span><span class="o">.</span><span class="n">EFI_VOLUME_FULL</span><span class="p">:</span> <span class="s2">&quot;EFI_VOLUME_FULL&quot;</span><span class="p">,</span>
  <span class="n">StatusCode</span><span class="o">.</span><span class="n">EFI_NO_MEDIA</span><span class="p">:</span> <span class="s2">&quot;EFI_NO_MEDIA&quot;</span><span class="p">,</span>
  <span class="n">StatusCode</span><span class="o">.</span><span class="n">EFI_MEDIA_CHANGED</span><span class="p">:</span> <span class="s2">&quot;EFI_MEDIA_CHANGED&quot;</span><span class="p">,</span>
  <span class="n">StatusCode</span><span class="o">.</span><span class="n">EFI_NOT_FOUND</span><span class="p">:</span> <span class="s2">&quot;EFI_NOT_FOUND&quot;</span><span class="p">,</span>
  <span class="n">StatusCode</span><span class="o">.</span><span class="n">EFI_ACCESS_DENIED</span><span class="p">:</span> <span class="s2">&quot;EFI_ACCESS_DENIED&quot;</span><span class="p">,</span>
  <span class="n">StatusCode</span><span class="o">.</span><span class="n">EFI_NO_RESPONSE</span><span class="p">:</span> <span class="s2">&quot;EFI_NO_RESPONSE&quot;</span><span class="p">,</span>
  <span class="n">StatusCode</span><span class="o">.</span><span class="n">EFI_NO_MAPPING</span><span class="p">:</span> <span class="s2">&quot;EFI_NO_MAPPING&quot;</span><span class="p">,</span>
  <span class="n">StatusCode</span><span class="o">.</span><span class="n">EFI_TIMEOUT</span><span class="p">:</span> <span class="s2">&quot;EFI_TIMEOUT&quot;</span><span class="p">,</span>
  <span class="n">StatusCode</span><span class="o">.</span><span class="n">EFI_NOT_STARTED</span><span class="p">:</span> <span class="s2">&quot;EFI_NOT_STARTED&quot;</span><span class="p">,</span>
  <span class="n">StatusCode</span><span class="o">.</span><span class="n">EFI_ALREADY_STARTED</span><span class="p">:</span> <span class="s2">&quot;EFI_ALREADY_STARTED&quot;</span><span class="p">,</span>
  <span class="n">StatusCode</span><span class="o">.</span><span class="n">EFI_ABORTED</span><span class="p">:</span> <span class="s2">&quot;EFI_ABORTED&quot;</span><span class="p">,</span>
  <span class="n">StatusCode</span><span class="o">.</span><span class="n">EFI_ICMP_ERROR</span><span class="p">:</span> <span class="s2">&quot;EFI_ICMP_ERROR&quot;</span><span class="p">,</span>
  <span class="n">StatusCode</span><span class="o">.</span><span class="n">EFI_TFTP_ERROR</span><span class="p">:</span> <span class="s2">&quot;EFI_TFTP_ERROR&quot;</span><span class="p">,</span>
  <span class="n">StatusCode</span><span class="o">.</span><span class="n">EFI_PROTOCOL_ERROR</span><span class="p">:</span> <span class="s2">&quot;EFI_PROTOCOL_ERROR&quot;</span><span class="p">,</span>
  <span class="n">StatusCode</span><span class="o">.</span><span class="n">EFI_INCOMPATIBLE_VERSION</span><span class="p">:</span> <span class="s2">&quot;EFI_INCOMPATIBLE_VERSION&quot;</span><span class="p">,</span>
  <span class="n">StatusCode</span><span class="o">.</span><span class="n">EFI_SECURITY_VIOLATION</span><span class="p">:</span> <span class="s2">&quot;EFI_SECURITY_VIOLATION&quot;</span><span class="p">,</span>
  <span class="n">StatusCode</span><span class="o">.</span><span class="n">EFI_CRC_ERROR</span><span class="p">:</span> <span class="s2">&quot;EFI_CRC_ERROR&quot;</span><span class="p">,</span>
  <span class="n">StatusCode</span><span class="o">.</span><span class="n">EFI_END_OF_MEDIA</span><span class="p">:</span> <span class="s2">&quot;EFI_END_OF_MEDIA&quot;</span><span class="p">,</span>
  <span class="n">StatusCode</span><span class="o">.</span><span class="n">EFI_END_OF_FILE</span><span class="p">:</span> <span class="s2">&quot;EFI_END_OF_FILE&quot;</span><span class="p">,</span>
  <span class="n">StatusCode</span><span class="o">.</span><span class="n">EFI_INVALID_LANGUAGE</span><span class="p">:</span> <span class="s2">&quot;EFI_INVALID_LANGUAGE&quot;</span><span class="p">,</span>
  <span class="n">StatusCode</span><span class="o">.</span><span class="n">EFI_COMPROMISED_DATA</span><span class="p">:</span> <span class="s2">&quot;EFI_COMPROMISED_DATA&quot;</span><span class="p">,</span>
  <span class="n">StatusCode</span><span class="o">.</span><span class="n">EFI_HTTP_ERROR</span><span class="p">:</span> <span class="s2">&quot;EFI_HTTP_ERROR&quot;</span>
<span class="p">}</span>

<span class="n">EFI_MAX_BIT</span> <span class="o">=</span> <span class="mh">0x8000000000000000</span>

<div class="viewcode-block" id="EFI_ERROR_STR"><a class="viewcode-back" href="../../../modules/chipsec.hal.uefi_common.html#chipsec.hal.uefi_common.EFI_ERROR_STR">[docs]</a><span class="k">def</span> <span class="nf">EFI_ERROR_STR</span><span class="p">(</span> <span class="n">error</span> <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Translates an EFI_STATUS value into its corresponding textual representation.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">error</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">EFI_MAX_BIT</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">EFI_STATUS_DICT</span><span class="p">[</span><span class="n">error</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;UNKNOWN&quot;</span></div>

<span class="n">EFI_GUID_FMT</span> <span class="o">=</span> <span class="s2">&quot;16s&quot;</span>
<span class="n">EFI_GUID_SIZE</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">calcsize</span><span class="p">(</span><span class="n">EFI_GUID_FMT</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">EFI_GUID_STR</span><span class="p">(</span> <span class="n">guid</span> <span class="p">):</span>
    <span class="n">guid_str</span> <span class="o">=</span> <span class="n">UUID</span><span class="p">(</span><span class="n">bytes_le</span><span class="o">=</span><span class="n">guid</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">guid_str</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">align</span><span class="p">(</span><span class="n">of</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>
    <span class="n">of</span> <span class="o">=</span> <span class="p">(((</span><span class="n">of</span> <span class="o">+</span> <span class="n">size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span><span class="n">size</span><span class="p">)</span> <span class="o">*</span> <span class="n">size</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">of</span>

<span class="k">def</span> <span class="nf">bit_set</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="n">polarity</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">polarity</span><span class="p">:</span> <span class="n">value</span> <span class="o">=</span> <span class="o">~</span><span class="n">value</span>
    <span class="k">return</span> <span class="p">(</span> <span class="p">(</span><span class="n">value</span> <span class="o">&amp;</span> <span class="n">mask</span><span class="p">)</span> <span class="o">==</span> <span class="n">mask</span> <span class="p">)</span>

<span class="k">def</span> <span class="nf">get_3b_size</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">bytestostring</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">))</span>


<span class="c1"># #################################################################################################</span>
<span class="c1">#</span>
<span class="c1"># UEFI Variable (NVRAM) Parsing Functionality</span>
<span class="c1">#</span>
<span class="c1"># #################################################################################################</span>

<span class="n">SIGNATURE_LIST</span> <span class="o">=</span> <span class="s2">&quot;&lt;16sIII&quot;</span>
<span class="n">SIGNATURE_LIST_size</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">calcsize</span><span class="p">(</span><span class="n">SIGNATURE_LIST</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">parse_sha256</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="k">return</span>

<span class="k">def</span> <span class="nf">parse_rsa2048</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="k">return</span>

<span class="k">def</span> <span class="nf">parse_rsa2048_sha256</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="k">return</span>

<span class="k">def</span> <span class="nf">parse_sha1</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="k">return</span>

<span class="k">def</span> <span class="nf">parse_rsa2048_sha1</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="k">return</span>

<span class="k">def</span> <span class="nf">parse_x509</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="k">return</span>

<span class="k">def</span> <span class="nf">parse_sha224</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="k">return</span>

<span class="k">def</span> <span class="nf">parse_sha384</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="k">return</span>

<span class="k">def</span> <span class="nf">parse_sha512</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="k">return</span>

<span class="k">def</span> <span class="nf">parse_x509_sha256</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="k">return</span>

<span class="k">def</span> <span class="nf">parse_x509_sha384</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="k">return</span>

<span class="k">def</span> <span class="nf">parse_x509_sha512</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="k">return</span>

<span class="k">def</span> <span class="nf">parse_external</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="k">return</span>

<span class="k">def</span> <span class="nf">parse_pkcs7</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="k">return</span>

<span class="n">sig_types</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;C1C41626-504C-4092-ACA9-41F936934328&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;EFI_CERT_SHA256_GUID&quot;</span><span class="p">,</span> <span class="n">parse_sha256</span><span class="p">,</span> <span class="mh">0x30</span><span class="p">,</span> <span class="s2">&quot;SHA256&quot;</span><span class="p">),</span> \
             <span class="s2">&quot;3C5766E8-269C-4E34-AA14-ED776E85B3B6&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;EFI_CERT_RSA2048_GUID&quot;</span><span class="p">,</span> <span class="n">parse_rsa2048</span><span class="p">,</span> <span class="mh">0x110</span><span class="p">,</span> <span class="s2">&quot;RSA2048&quot;</span><span class="p">),</span> \
             <span class="s2">&quot;E2B36190-879B-4A3D-AD8D-F2E7BBA32784&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;EFI_CERT_RSA2048_SHA256_GUID&quot;</span><span class="p">,</span> <span class="n">parse_rsa2048_sha256</span><span class="p">,</span> <span class="mh">0x110</span><span class="p">,</span> <span class="s2">&quot;RSA2048_SHA256&quot;</span><span class="p">),</span> \
             <span class="s2">&quot;826CA512-CF10-4AC9-B187-BE01496631BD&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;EFI_CERT_SHA1_GUID&quot;</span><span class="p">,</span> <span class="n">parse_sha1</span><span class="p">,</span> <span class="mh">0x24</span><span class="p">,</span> <span class="s2">&quot;SHA1&quot;</span><span class="p">),</span> \
             <span class="s2">&quot;67F8444F-8743-48F1-A328-1EAAB8736080&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;EFI_CERT_RSA2048_SHA1_GUID&quot;</span><span class="p">,</span> <span class="n">parse_rsa2048_sha1</span><span class="p">,</span> <span class="mh">0x110</span><span class="p">,</span> <span class="s2">&quot;RSA2048_SHA1&quot;</span><span class="p">),</span> \
             <span class="s2">&quot;A5C059A1-94E4-4AA7-87B5-AB155C2BF072&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;EFI_CERT_X509_GUID&quot;</span><span class="p">,</span> <span class="n">parse_x509</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;X509&quot;</span><span class="p">),</span> \
             <span class="s2">&quot;0B6E5233-A65C-44C9-9407-D9AB83BFC8BD&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;EFI_CERT_SHA224_GUID&quot;</span><span class="p">,</span> <span class="n">parse_sha224</span><span class="p">,</span> <span class="mh">0x2c</span><span class="p">,</span> <span class="s2">&quot;SHA224&quot;</span><span class="p">),</span> \
             <span class="s2">&quot;FF3E5307-9FD0-48C9-85F1-8AD56C701E01&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;EFI_CERT_SHA384_GUID&quot;</span><span class="p">,</span> <span class="n">parse_sha384</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">,</span> <span class="s2">&quot;SHA384&quot;</span><span class="p">),</span> \
             <span class="s2">&quot;093E0FAE-A6C4-4F50-9F1B-D41E2B89C19A&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;EFI_CERT_SHA512_GUID&quot;</span><span class="p">,</span> <span class="n">parse_sha512</span><span class="p">,</span> <span class="mh">0x50</span><span class="p">,</span> <span class="s2">&quot;SHA512&quot;</span><span class="p">),</span> \
             <span class="s2">&quot;3bd2a492-96c0-4079-b420-fcf98ef103ed&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;EFI_CERT_X509_SHA256_GUID&quot;</span><span class="p">,</span> <span class="n">parse_x509_sha256</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">,</span> <span class="s2">&quot;X509_SHA256&quot;</span><span class="p">),</span> \
             <span class="s2">&quot;7076876e-80c2-4ee6-aad2-28b349a6865b&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;EFI_CERT_X509_SHA384_GUID&quot;</span><span class="p">,</span> <span class="n">parse_x509_sha384</span><span class="p">,</span> <span class="mh">0x50</span><span class="p">,</span> <span class="s2">&quot;X509_SHA384&quot;</span><span class="p">),</span> \
             <span class="s2">&quot;446dbf63-2502-4cda-bcfa-2465d2b0fe9d&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;EFI_CERT_X509_SHA512_GUID&quot;</span><span class="p">,</span> <span class="n">parse_x509_sha512</span><span class="p">,</span> <span class="mh">0x60</span><span class="p">,</span> <span class="s2">&quot;X509_SHA512&quot;</span><span class="p">),</span> \
             <span class="s2">&quot;452e8ced-dfff-4b8c-ae01-5118862e682c&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;EFI_CERT_EXTERNAL_MANAGEMENT_GUID&quot;</span><span class="p">,</span> <span class="n">parse_external</span><span class="p">,</span> <span class="mh">0x11</span><span class="p">,</span> <span class="s2">&quot;EXTERNAL_MANAGEMENT&quot;</span><span class="p">),</span> \
             <span class="s2">&quot;4AAFD29D-68DF-49EE-8AA9-347D375665A7&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;EFI_CERT_TYPE_PKCS7_GUID&quot;</span><span class="p">,</span> <span class="n">parse_pkcs7</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;PKCS7&quot;</span><span class="p">),</span> \
             <span class="p">}</span>


<span class="k">def</span> <span class="nf">parse_sb_db</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">decode_dir</span><span class="p">):</span>
    <span class="n">entries</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">dof</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">nsig</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">db_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
    <span class="k">if</span> <span class="mi">0</span> <span class="o">==</span> <span class="n">db_size</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">entries</span>

    <span class="c1"># some platforms have 0&#39;s in the beginnig, skip all 0 (no known SignatureType starts with 0x00):</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">dof</span> <span class="o">+</span> <span class="n">SIGNATURE_LIST_size</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">db_size</span><span class="p">:</span>
        <span class="n">SignatureType0</span><span class="p">,</span> <span class="n">SignatureListSize</span><span class="p">,</span> <span class="n">SignatureHeaderSize</span><span class="p">,</span> <span class="n">SignatureSize</span> \
         <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">SIGNATURE_LIST</span><span class="p">,</span> <span class="n">db</span><span class="p">[</span><span class="n">dof</span><span class="p">:</span><span class="n">dof</span> <span class="o">+</span><span class="n">SIGNATURE_LIST_size</span><span class="p">])</span>

        <span class="c1"># prevent infinite loop when parsing malformed var</span>
        <span class="k">if</span> <span class="n">SignatureListSize</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">logger</span><span class="p">()</span><span class="o">.</span><span class="n">log_bad</span><span class="p">(</span><span class="s2">&quot;db parsing failed!&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">entries</span>

        <span class="c1"># Determine the signature type</span>
        <span class="n">SignatureType</span> <span class="o">=</span> <span class="n">EFI_GUID_STR</span><span class="p">(</span><span class="n">SignatureType0</span><span class="p">)</span>
        <span class="n">sig_parse_f</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">sig_size</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">SignatureType</span> <span class="ow">in</span> <span class="n">sig_types</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">sig_name</span><span class="p">,</span> <span class="n">sig_parse_f</span><span class="p">,</span> <span class="n">sig_size</span><span class="p">,</span> <span class="n">short_name</span> <span class="o">=</span> <span class="n">sig_types</span><span class="p">[</span><span class="n">SignatureType</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="p">()</span><span class="o">.</span><span class="n">log_bad</span><span class="p">(</span><span class="s1">&#39;Unknown signature type </span><span class="si">{}</span><span class="s1">, skipping signature decode.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">SignatureType</span><span class="p">))</span>
            <span class="n">dof</span> <span class="o">+=</span> <span class="n">SignatureListSize</span>
            <span class="k">continue</span>

        <span class="c1"># Extract signature data blobs</span>
        <span class="k">if</span> <span class="p">(((</span><span class="n">sig_size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">sig_size</span> <span class="o">==</span> <span class="n">SignatureSize</span><span class="p">))</span> <span class="ow">or</span> <span class="p">((</span><span class="n">sig_size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">SignatureSize</span> <span class="o">&gt;=</span> <span class="mh">0x10</span><span class="p">))):</span>
            <span class="n">sof</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">sig_list</span> <span class="o">=</span> <span class="n">db</span><span class="p">[</span><span class="n">dof</span> <span class="o">+</span><span class="n">SIGNATURE_LIST_size</span> <span class="o">+</span><span class="n">SignatureHeaderSize</span><span class="p">:</span><span class="n">dof</span> <span class="o">+</span><span class="n">SignatureListSize</span><span class="p">]</span>
            <span class="n">sig_list_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sig_list</span><span class="p">)</span>
            <span class="k">while</span> <span class="p">((</span><span class="n">sof</span> <span class="o">+</span> <span class="n">EFI_GUID_SIZE</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">sig_list_size</span><span class="p">):</span>
                <span class="n">sig_data</span> <span class="o">=</span> <span class="n">sig_list</span><span class="p">[</span><span class="n">sof</span><span class="p">:</span><span class="n">sof</span> <span class="o">+</span><span class="n">SignatureSize</span><span class="p">]</span>
                <span class="n">owner0</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">EFI_GUID_FMT</span><span class="p">,</span> <span class="n">sig_data</span><span class="p">[:</span><span class="n">EFI_GUID_SIZE</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">owner</span> <span class="o">=</span> <span class="n">EFI_GUID_STR</span><span class="p">(</span><span class="n">owner0</span><span class="p">)</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">sig_data</span><span class="p">[</span><span class="n">EFI_GUID_SIZE</span><span class="p">:]</span>
                <span class="n">entries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">data</span> <span class="p">)</span>
                <span class="n">sig_file_name</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">-</span><span class="si">{}</span><span class="s2">-</span><span class="si">{:02d}</span><span class="s2">.bin&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">short_name</span><span class="p">,</span> <span class="n">owner</span><span class="p">,</span> <span class="n">nsig</span><span class="p">)</span>
                <span class="n">sig_file_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">decode_dir</span><span class="p">,</span> <span class="n">sig_file_name</span><span class="p">)</span>
                <span class="n">write_file</span><span class="p">(</span><span class="n">sig_file_name</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">sig_parse_f</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
                    <span class="n">sig_parse_f</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                <span class="n">sof</span> <span class="o">=</span> <span class="n">sof</span> <span class="o">+</span> <span class="n">SignatureSize</span>
                <span class="n">nsig</span> <span class="o">=</span> <span class="n">nsig</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">err_str</span> <span class="o">=</span> <span class="s2">&quot;Wrong SignatureSize for </span><span class="si">{}</span><span class="s2"> type: 0x</span><span class="si">{:X}</span><span class="s2">.&quot;</span> <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">SignatureType</span><span class="p">,</span> <span class="n">SignatureSize</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">sig_size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span> <span class="n">err_str</span> <span class="o">=</span> <span class="n">err_str</span> <span class="o">+</span> <span class="s2">&quot; Must be 0x</span><span class="si">{:X}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sig_size</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>              <span class="n">err_str</span> <span class="o">=</span> <span class="n">err_str</span> <span class="o">+</span> <span class="s2">&quot; Must be &gt;= 0x10.&quot;</span>
            <span class="n">logger</span><span class="p">()</span><span class="o">.</span><span class="n">error</span><span class="p">(</span> <span class="n">err_str</span> <span class="p">)</span>
            <span class="n">logger</span><span class="p">()</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Skipping signature decode for this list.&#39;</span><span class="p">)</span>
        <span class="n">dof</span> <span class="o">=</span> <span class="n">dof</span> <span class="o">+</span> <span class="n">SignatureListSize</span>

    <span class="k">return</span> <span class="n">entries</span>

<span class="c1">#</span>
<span class="c1">#  &quot;certdb&quot; variable stores the signer&#39;s certificates for non PK/KEK/DB/DBX</span>
<span class="c1"># variables with EFI_VARIABLE_TIME_BASED_AUTHENTICATED_WRITE_ACCESS|EFI_VARIABLE_NON_VOLATILE set.</span>
<span class="c1">#  &quot;certdbv&quot; variable stores the signer&#39;s certificates for non PK/KEK/DB/DBX</span>
<span class="c1"># variables with EFI_VARIABLE_TIME_BASED_AUTHENTICATED_WRITE_ACCESS set</span>
<span class="c1">#</span>
<span class="c1"># GUID: gEfiCertDbGuid</span>
<span class="c1">#</span>
<span class="c1"># We need maintain atomicity.</span>
<span class="c1">#</span>
<span class="c1"># Format:</span>
<span class="c1"># +----------------------------+</span>
<span class="c1"># | UINT32                     | &lt;-- CertDbListSize, including this UINT32</span>
<span class="c1"># +----------------------------+</span>
<span class="c1"># | AUTH_CERT_DB_DATA          | &lt;-- First CERT</span>
<span class="c1"># +----------------------------+</span>
<span class="c1"># | ........                   |</span>
<span class="c1"># +----------------------------+</span>
<span class="c1"># | AUTH_CERT_DB_DATA          | &lt;-- Last CERT</span>
<span class="c1"># +----------------------------+</span>
<span class="c1">#</span>
<span class="c1"># typedef struct {</span>
<span class="c1">#   EFI_GUID    VendorGuid;</span>
<span class="c1">#   UINT32      CertNodeSize;</span>
<span class="c1">#   UINT32      NameSize;</span>
<span class="c1">#   UINT32      CertDataSize;</span>
<span class="c1">#   /// CHAR16  VariableName[NameSize];</span>
<span class="c1">#   /// UINT8   CertData[CertDataSize];</span>
<span class="c1"># } AUTH_CERT_DB_DATA;</span>
<span class="c1">#</span>
<span class="n">AUTH_CERT_DB_LIST_HEAD</span> <span class="o">=</span> <span class="s2">&quot;&lt;I&quot;</span>
<span class="n">AUTH_CERT_DB_LIST_HEAD_size</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">calcsize</span><span class="p">(</span><span class="n">AUTH_CERT_DB_LIST_HEAD</span><span class="p">)</span>
<span class="n">AUTH_CERT_DB_DATA</span> <span class="o">=</span> <span class="s2">&quot;&lt;16sIII&quot;</span>
<span class="n">AUTH_CERT_DB_DATA_size</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">calcsize</span><span class="p">(</span><span class="n">AUTH_CERT_DB_DATA</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">parse_auth_var</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">decode_dir</span><span class="p">):</span>
    <span class="n">entries</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">dof</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">nsig</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">db_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>

    <span class="c1"># Verify that list makes sense</span>
    <span class="k">if</span> <span class="n">db_size</span> <span class="o">&lt;</span> <span class="n">AUTH_CERT_DB_LIST_HEAD_size</span><span class="p">:</span>
        <span class="n">logger</span><span class="p">()</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Cert list empty.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">entries</span>
    <span class="n">expected_size</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">AUTH_CERT_DB_LIST_HEAD</span><span class="p">,</span> <span class="n">db</span><span class="p">[</span><span class="n">dof</span><span class="p">:</span><span class="n">dof</span> <span class="o">+</span><span class="n">AUTH_CERT_DB_LIST_HEAD_size</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">db_size</span> <span class="o">!=</span> <span class="n">expected_size</span><span class="p">:</span>
        <span class="n">logger</span><span class="p">()</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Expected size of cert list did not match actual size.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">entries</span>
    <span class="n">dof</span> <span class="o">+=</span> <span class="n">AUTH_CERT_DB_LIST_HEAD_size</span>

    <span class="c1"># Loop through all the certs in the list.</span>
    <span class="k">while</span> <span class="n">dof</span> <span class="o">+</span> <span class="n">AUTH_CERT_DB_DATA_size</span> <span class="o">&lt;</span> <span class="n">db_size</span><span class="p">:</span>
        <span class="n">ven_guid0</span><span class="p">,</span> <span class="n">cert_node_size</span><span class="p">,</span> <span class="n">name_size</span><span class="p">,</span> <span class="n">cert_data_size</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">AUTH_CERT_DB_DATA</span><span class="p">,</span> <span class="n">db</span><span class="p">[</span><span class="n">dof</span><span class="p">:</span><span class="n">dof</span> <span class="o">+</span><span class="n">AUTH_CERT_DB_DATA_size</span><span class="p">])</span>
        <span class="n">vendor_guid</span> <span class="o">=</span> <span class="n">EFI_GUID_STR</span><span class="p">(</span><span class="n">ven_guid0</span><span class="p">)</span>
        <span class="n">name_size</span> <span class="o">*=</span> <span class="mi">2</span>  <span class="c1"># Name size is actually the number of CHAR16 in the name array</span>
        <span class="n">tof</span> <span class="o">=</span> <span class="n">dof</span> <span class="o">+</span> <span class="n">AUTH_CERT_DB_DATA_size</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">var_name</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">db</span><span class="p">[</span><span class="n">tof</span><span class="p">:</span><span class="n">tof</span> <span class="o">+</span><span class="n">name_size</span><span class="p">],</span> <span class="s1">&#39;utf-16&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">UnicodeDecodeError</span><span class="p">:</span>
            <span class="n">logger</span><span class="p">()</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Unable to decode </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">db</span><span class="p">[</span><span class="n">tof</span><span class="p">:</span><span class="n">tof</span> <span class="o">+</span><span class="n">name_size</span><span class="p">]))</span>
            <span class="n">var_name</span> <span class="o">=</span> <span class="s2">&quot;chipsec.exceptions!&quot;</span>
        <span class="n">tof</span> <span class="o">+=</span> <span class="n">name_size</span>
        <span class="n">sig_data</span> <span class="o">=</span> <span class="n">db</span><span class="p">[</span><span class="n">tof</span><span class="p">:</span><span class="n">tof</span> <span class="o">+</span><span class="n">cert_data_size</span><span class="p">]</span>
        <span class="n">entries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sig_data</span><span class="p">)</span>
        <span class="n">sig_file_name</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">-</span><span class="si">{}</span><span class="s1">-</span><span class="si">{:02X}</span><span class="s1">.bin&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">vendor_guid</span><span class="p">,</span> <span class="n">codecs</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">var_name</span><span class="p">),</span> <span class="n">nsig</span><span class="p">)</span>
        <span class="n">sig_file_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">decode_dir</span><span class="p">,</span> <span class="n">sig_file_name</span><span class="p">)</span>
        <span class="n">write_file</span><span class="p">(</span><span class="n">sig_file_name</span><span class="p">,</span> <span class="n">sig_data</span><span class="p">)</span>
        <span class="n">dof</span> <span class="o">+=</span> <span class="n">cert_node_size</span>
        <span class="n">nsig</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">return</span> <span class="n">entries</span>

<span class="n">ESAL_SIG_SIZE</span> <span class="o">=</span> <span class="mi">256</span>

<span class="k">def</span> <span class="nf">parse_esal_var</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">decode_dir</span><span class="p">):</span>
    <span class="n">entries</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">dof</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">nsig</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">db_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>

    <span class="c1"># Check to see how many signatures exist</span>
    <span class="k">if</span> <span class="n">db_size</span> <span class="o">&lt;</span> <span class="n">ESAL_SIG_SIZE</span><span class="p">:</span>
        <span class="n">logger</span><span class="p">()</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;No signatures present.&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">entries</span>

    <span class="c1"># Extract signatures</span>
    <span class="k">while</span> <span class="n">dof</span> <span class="o">+</span> <span class="n">ESAL_SIG_SIZE</span> <span class="o">&lt;=</span> <span class="n">db_size</span><span class="p">:</span>
        <span class="n">key_data</span> <span class="o">=</span> <span class="n">db</span><span class="p">[</span><span class="n">dof</span><span class="p">:</span><span class="n">dof</span> <span class="o">+</span><span class="n">ESAL_SIG_SIZE</span><span class="p">]</span>
        <span class="n">entries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key_data</span><span class="p">)</span>
        <span class="n">key_file_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">decode_dir</span><span class="p">,</span> <span class="s1">&#39;AuthVarKeyDatabase-cert-</span><span class="si">{:02X}</span><span class="s1">.bin&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nsig</span><span class="p">))</span>
        <span class="n">write_file</span><span class="p">(</span><span class="n">key_file_name</span><span class="p">,</span> <span class="n">key_data</span><span class="p">)</span>
        <span class="n">dof</span> <span class="o">+=</span> <span class="n">ESAL_SIG_SIZE</span>
        <span class="n">nsig</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">return</span> <span class="n">entries</span>

<span class="n">SECURE_BOOT_SIG_VAR</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">AUTH_SIG_VAR</span>        <span class="o">=</span> <span class="mi">2</span>
<span class="n">ESAL_SIG_VAR</span>        <span class="o">=</span> <span class="mi">3</span>

<span class="k">def</span> <span class="nf">parse_efivar_file</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">var</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">var_type</span><span class="o">=</span><span class="n">SECURE_BOOT_SIG_VAR</span><span class="p">):</span>
    <span class="n">logger</span><span class="p">()</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;Processing certs in file: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fname</span><span class="p">))</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">var</span><span class="p">:</span>
        <span class="n">var</span> <span class="o">=</span> <span class="n">read_file</span><span class="p">(</span> <span class="n">fname</span> <span class="p">)</span>
    <span class="n">var_path</span> <span class="o">=</span> <span class="n">fname</span> <span class="o">+</span> <span class="s1">&#39;.dir&#39;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span> <span class="n">var_path</span> <span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span> <span class="n">var_path</span> <span class="p">)</span>
    <span class="k">if</span> <span class="n">var_type</span> <span class="o">==</span> <span class="n">SECURE_BOOT_SIG_VAR</span><span class="p">:</span>
        <span class="n">parse_sb_db</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">var_path</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">var_type</span> <span class="o">==</span> <span class="n">AUTH_SIG_VAR</span><span class="p">:</span>
        <span class="n">parse_auth_var</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">var_path</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">var_type</span> <span class="o">==</span> <span class="n">ESAL_SIG_VAR</span><span class="p">:</span>
        <span class="n">parse_esal_var</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">var_path</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">logger</span><span class="p">()</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Unsupported variable type requested: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">var_type</span><span class="p">))</span>


<span class="c1">########################################################################################################</span>
<span class="c1">#</span>
<span class="c1"># S3 Resume Boot-Script Parsing Functionality</span>
<span class="c1">#</span>
<span class="c1">########################################################################################################</span>

<span class="n">BOOTSCRIPT_TABLE_OFFSET</span>          <span class="o">=</span> <span class="mi">24</span>
<span class="n">RUNTIME_SCRIPT_TABLE_BASE_OFFSET</span> <span class="o">=</span> <span class="mi">32</span>
<span class="n">ACPI_VARIABLE_SET_STRUCT_SIZE</span>    <span class="o">=</span> <span class="mh">0x48</span>
<span class="n">S3_BOOTSCRIPT_VARIABLES</span>          <span class="o">=</span> <span class="p">[</span> <span class="s1">&#39;AcpiGlobalVariable&#39;</span> <span class="p">]</span>

<span class="n">MAX_S3_BOOTSCRIPT_ENTRY_LENGTH</span>   <span class="o">=</span> <span class="mh">0x200</span>


<span class="c1">#</span>
<span class="c1"># MdePkg\Include\Pi\PiS3BootScript.h</span>
<span class="c1">#</span>
<span class="c1">#//*******************************************</span>
<span class="c1">#// EFI Boot Script Opcode definitions</span>
<span class="c1">#//*******************************************</span>

<span class="k">class</span> <span class="nc">S3BootScriptOpcode</span><span class="p">:</span>
    <span class="n">EFI_BOOT_SCRIPT_IO_WRITE_OPCODE</span>               <span class="o">=</span> <span class="mh">0x00</span>
    <span class="n">EFI_BOOT_SCRIPT_IO_READ_WRITE_OPCODE</span>          <span class="o">=</span> <span class="mh">0x01</span>
    <span class="n">EFI_BOOT_SCRIPT_MEM_WRITE_OPCODE</span>              <span class="o">=</span> <span class="mh">0x02</span>
    <span class="n">EFI_BOOT_SCRIPT_MEM_READ_WRITE_OPCODE</span>         <span class="o">=</span> <span class="mh">0x03</span>
    <span class="n">EFI_BOOT_SCRIPT_PCI_CONFIG_WRITE_OPCODE</span>       <span class="o">=</span> <span class="mh">0x04</span>
    <span class="n">EFI_BOOT_SCRIPT_PCI_CONFIG_READ_WRITE_OPCODE</span>  <span class="o">=</span> <span class="mh">0x05</span>
    <span class="n">EFI_BOOT_SCRIPT_SMBUS_EXECUTE_OPCODE</span>          <span class="o">=</span> <span class="mh">0x06</span>
    <span class="n">EFI_BOOT_SCRIPT_STALL_OPCODE</span>                  <span class="o">=</span> <span class="mh">0x07</span>
    <span class="n">EFI_BOOT_SCRIPT_DISPATCH_OPCODE</span>               <span class="o">=</span> <span class="mh">0x08</span>
    <span class="n">EFI_BOOT_SCRIPT_TERMINATE_OPCODE</span>              <span class="o">=</span> <span class="mh">0xFF</span>


<span class="k">class</span> <span class="nc">S3BootScriptOpcode_MDE</span> <span class="p">(</span><span class="n">S3BootScriptOpcode</span><span class="p">):</span>
    <span class="n">EFI_BOOT_SCRIPT_DISPATCH_2_OPCODE</span>             <span class="o">=</span> <span class="mh">0x09</span>
    <span class="n">EFI_BOOT_SCRIPT_INFORMATION_OPCODE</span>            <span class="o">=</span> <span class="mh">0x0A</span>
    <span class="n">EFI_BOOT_SCRIPT_PCI_CONFIG2_WRITE_OPCODE</span>      <span class="o">=</span> <span class="mh">0x0B</span>
    <span class="n">EFI_BOOT_SCRIPT_PCI_CONFIG2_READ_WRITE_OPCODE</span> <span class="o">=</span> <span class="mh">0x0C</span>
    <span class="n">EFI_BOOT_SCRIPT_IO_POLL_OPCODE</span>                <span class="o">=</span> <span class="mh">0x0D</span>
    <span class="n">EFI_BOOT_SCRIPT_MEM_POLL_OPCODE</span>               <span class="o">=</span> <span class="mh">0x0E</span>
    <span class="n">EFI_BOOT_SCRIPT_PCI_CONFIG_POLL_OPCODE</span>        <span class="o">=</span> <span class="mh">0x0F</span>
    <span class="n">EFI_BOOT_SCRIPT_PCI_CONFIG2_POLL_OPCODE</span>       <span class="o">=</span> <span class="mh">0x10</span>

<span class="c1">#</span>
<span class="c1"># EdkCompatibilityPkg\Foundation\Framework\Include\EfiBootScript.h</span>
<span class="c1">#</span>

<span class="k">class</span> <span class="nc">S3BootScriptOpcode_EdkCompat</span> <span class="p">(</span><span class="n">S3BootScriptOpcode</span><span class="p">):</span>
    <span class="n">EFI_BOOT_SCRIPT_MEM_POLL_OPCODE</span>               <span class="o">=</span> <span class="mh">0x09</span>
    <span class="n">EFI_BOOT_SCRIPT_INFORMATION_OPCODE</span>            <span class="o">=</span> <span class="mh">0x0A</span>
    <span class="n">EFI_BOOT_SCRIPT_PCI_CONFIG2_WRITE_OPCODE</span>      <span class="o">=</span> <span class="mh">0x0B</span>
    <span class="n">EFI_BOOT_SCRIPT_PCI_CONFIG2_READ_WRITE_OPCODE</span> <span class="o">=</span> <span class="mh">0x0C</span>
    <span class="n">EFI_BOOT_SCRIPT_TABLE_OPCODE</span>                  <span class="o">=</span> <span class="mh">0xAA</span>

<span class="c1">#</span>
<span class="c1"># Names of S3 Boot Script Opcodes</span>
<span class="c1">#</span>
<span class="n">script_opcodes</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">S3BootScriptOpcode</span><span class="o">.</span><span class="n">EFI_BOOT_SCRIPT_IO_WRITE_OPCODE</span><span class="p">:</span>               <span class="s2">&quot;S3_BOOTSCRIPT_IO_WRITE&quot;</span><span class="p">,</span>
    <span class="n">S3BootScriptOpcode</span><span class="o">.</span><span class="n">EFI_BOOT_SCRIPT_IO_READ_WRITE_OPCODE</span><span class="p">:</span>          <span class="s2">&quot;S3_BOOTSCRIPT_IO_READ_WRITE&quot;</span><span class="p">,</span>
    <span class="n">S3BootScriptOpcode</span><span class="o">.</span><span class="n">EFI_BOOT_SCRIPT_MEM_WRITE_OPCODE</span><span class="p">:</span>              <span class="s2">&quot;S3_BOOTSCRIPT_MEM_WRITE&quot;</span><span class="p">,</span>
    <span class="n">S3BootScriptOpcode</span><span class="o">.</span><span class="n">EFI_BOOT_SCRIPT_MEM_READ_WRITE_OPCODE</span><span class="p">:</span>         <span class="s2">&quot;S3_BOOTSCRIPT_MEM_READ_WRITE&quot;</span><span class="p">,</span>
    <span class="n">S3BootScriptOpcode</span><span class="o">.</span><span class="n">EFI_BOOT_SCRIPT_PCI_CONFIG_WRITE_OPCODE</span><span class="p">:</span>       <span class="s2">&quot;S3_BOOTSCRIPT_PCI_CONFIG_WRITE&quot;</span><span class="p">,</span>
    <span class="n">S3BootScriptOpcode</span><span class="o">.</span><span class="n">EFI_BOOT_SCRIPT_PCI_CONFIG_READ_WRITE_OPCODE</span><span class="p">:</span>  <span class="s2">&quot;S3_BOOTSCRIPT_PCI_CONFIG_READ_WRITE&quot;</span><span class="p">,</span>
    <span class="n">S3BootScriptOpcode</span><span class="o">.</span><span class="n">EFI_BOOT_SCRIPT_SMBUS_EXECUTE_OPCODE</span><span class="p">:</span>          <span class="s2">&quot;S3_BOOTSCRIPT_SMBUS_EXECUTE&quot;</span><span class="p">,</span>
    <span class="n">S3BootScriptOpcode</span><span class="o">.</span><span class="n">EFI_BOOT_SCRIPT_STALL_OPCODE</span><span class="p">:</span>                  <span class="s2">&quot;S3_BOOTSCRIPT_STALL&quot;</span><span class="p">,</span>
    <span class="n">S3BootScriptOpcode</span><span class="o">.</span><span class="n">EFI_BOOT_SCRIPT_DISPATCH_OPCODE</span><span class="p">:</span>               <span class="s2">&quot;S3_BOOTSCRIPT_DISPATCH&quot;</span><span class="p">,</span>
    <span class="c1">#S3BootScriptOpcode.EFI_BOOT_SCRIPT_DISPATCH_2_OPCODE:             &quot;S3_BOOTSCRIPT_DISPATCH_2&quot;,</span>
    <span class="c1">#S3BootScriptOpcode.EFI_BOOT_SCRIPT_INFORMATION_OPCODE:            &quot;S3_BOOTSCRIPT_INFORMATION&quot;,</span>
    <span class="c1">#S3BootScriptOpcode.EFI_BOOT_SCRIPT_PCI_CONFIG2_WRITE_OPCODE:      &quot;S3_BOOTSCRIPT_PCI_CONFIG2_WRITE&quot;,</span>
    <span class="c1">#S3BootScriptOpcode.EFI_BOOT_SCRIPT_PCI_CONFIG2_READ_WRITE_OPCODE: &quot;S3_BOOTSCRIPT_PCI_CONFIG2_READ_WRITE&quot;,</span>
    <span class="c1">#S3BootScriptOpcode.EFI_BOOT_SCRIPT_IO_POLL_OPCODE:                &quot;S3_BOOTSCRIPT_IO_POLL&quot;,</span>
    <span class="c1">#S3BootScriptOpcode.EFI_BOOT_SCRIPT_MEM_POLL_OPCODE:               &quot;S3_BOOTSCRIPT_MEM_POLL&quot;,</span>
    <span class="c1">#S3BootScriptOpcode.EFI_BOOT_SCRIPT_PCI_CONFIG_POLL_OPCODE:        &quot;S3_BOOTSCRIPT_PCI_CONFIG_POLL&quot;,</span>
    <span class="c1">#S3BootScriptOpcode.EFI_BOOT_SCRIPT_PCI_CONFIG2_POLL_OPCODE:       &quot;S3_BOOTSCRIPT_PCI_CONFIG2_POLL&quot;,</span>
    <span class="c1">#S3BootScriptOpcode.EFI_BOOT_SCRIPT_TABLE_OPCODE:                  &quot;S3_BOOTSCRIPT_TABLE&quot;,</span>
    <span class="n">S3BootScriptOpcode</span><span class="o">.</span><span class="n">EFI_BOOT_SCRIPT_TERMINATE_OPCODE</span><span class="p">:</span>              <span class="s2">&quot;S3_BOOTSCRIPT_TERMINATE&quot;</span>
<span class="p">}</span>



<span class="c1"># //*******************************************</span>
<span class="c1"># // EFI_BOOT_SCRIPT_WIDTH</span>
<span class="c1"># //*******************************************</span>
<span class="c1"># typedef enum {</span>
<span class="c1"># EfiBootScriptWidthUint8,</span>
<span class="c1"># EfiBootScriptWidthUint16,</span>
<span class="c1"># EfiBootScriptWidthUint32,</span>
<span class="c1"># EfiBootScriptWidthUint64,</span>
<span class="c1"># EfiBootScriptWidthFifoUint8,</span>
<span class="c1"># EfiBootScriptWidthFifoUint16,</span>
<span class="c1"># EfiBootScriptWidthFifoUint32,</span>
<span class="c1"># EfiBootScriptWidthFifoUint64,</span>
<span class="c1"># EfiBootScriptWidthFillUint8,</span>
<span class="c1"># EfiBootScriptWidthFillUint16,</span>
<span class="c1"># EfiBootScriptWidthFillUint32,</span>
<span class="c1"># EfiBootScriptWidthFillUint64,</span>
<span class="c1"># EfiBootScriptWidthMaximum</span>
<span class="c1"># } EFI_BOOT_SCRIPT_WIDTH;</span>

<span class="k">class</span> <span class="nc">S3BootScriptWidth</span><span class="p">:</span>
    <span class="n">EFI_BOOT_SCRIPT_WIDTH_UINT8</span>  <span class="o">=</span> <span class="mh">0x00</span>
    <span class="n">EFI_BOOT_SCRIPT_WIDTH_UINT16</span> <span class="o">=</span> <span class="mh">0x01</span>
    <span class="n">EFI_BOOT_SCRIPT_WIDTH_UINT32</span> <span class="o">=</span> <span class="mh">0x02</span>
    <span class="n">EFI_BOOT_SCRIPT_WIDTH_UINT64</span> <span class="o">=</span> <span class="mh">0x03</span>

<span class="n">script_width_sizes</span> <span class="o">=</span> <span class="p">{</span>
  <span class="n">S3BootScriptWidth</span><span class="o">.</span><span class="n">EFI_BOOT_SCRIPT_WIDTH_UINT8</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
  <span class="n">S3BootScriptWidth</span><span class="o">.</span><span class="n">EFI_BOOT_SCRIPT_WIDTH_UINT16</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
  <span class="n">S3BootScriptWidth</span><span class="o">.</span><span class="n">EFI_BOOT_SCRIPT_WIDTH_UINT32</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
  <span class="n">S3BootScriptWidth</span><span class="o">.</span><span class="n">EFI_BOOT_SCRIPT_WIDTH_UINT64</span><span class="p">:</span> <span class="mi">8</span>
<span class="p">}</span>

<span class="n">script_width_values</span> <span class="o">=</span> <span class="p">{</span>
  <span class="mi">1</span><span class="p">:</span> <span class="n">S3BootScriptWidth</span><span class="o">.</span><span class="n">EFI_BOOT_SCRIPT_WIDTH_UINT8</span><span class="p">,</span>
  <span class="mi">2</span><span class="p">:</span> <span class="n">S3BootScriptWidth</span><span class="o">.</span><span class="n">EFI_BOOT_SCRIPT_WIDTH_UINT16</span><span class="p">,</span>
  <span class="mi">4</span><span class="p">:</span> <span class="n">S3BootScriptWidth</span><span class="o">.</span><span class="n">EFI_BOOT_SCRIPT_WIDTH_UINT32</span><span class="p">,</span>
  <span class="mi">8</span><span class="p">:</span> <span class="n">S3BootScriptWidth</span><span class="o">.</span><span class="n">EFI_BOOT_SCRIPT_WIDTH_UINT64</span>
<span class="p">}</span>

<span class="n">script_width_formats</span> <span class="o">=</span> <span class="p">{</span>
  <span class="n">S3BootScriptWidth</span><span class="o">.</span><span class="n">EFI_BOOT_SCRIPT_WIDTH_UINT8</span><span class="p">:</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span>
  <span class="n">S3BootScriptWidth</span><span class="o">.</span><span class="n">EFI_BOOT_SCRIPT_WIDTH_UINT16</span><span class="p">:</span> <span class="s1">&#39;H&#39;</span><span class="p">,</span>
  <span class="n">S3BootScriptWidth</span><span class="o">.</span><span class="n">EFI_BOOT_SCRIPT_WIDTH_UINT32</span><span class="p">:</span> <span class="s1">&#39;I&#39;</span><span class="p">,</span>
  <span class="n">S3BootScriptWidth</span><span class="o">.</span><span class="n">EFI_BOOT_SCRIPT_WIDTH_UINT64</span><span class="p">:</span> <span class="s1">&#39;Q&#39;</span>
<span class="p">}</span>

<span class="c1"># //************************************************</span>
<span class="c1"># // EFI_SMBUS_DEVICE_ADDRESS</span>
<span class="c1"># //************************************************</span>
<span class="c1"># typedef struct _EFI_SMBUS_DEVICE_ADDRESS {</span>
<span class="c1"># UINTN SmbusDeviceAddress:7;</span>
<span class="c1"># } EFI_SMBUS_DEVICE_ADDRESS;</span>
<span class="c1"># //************************************************</span>
<span class="c1"># // EFI_SMBUS_DEVICE_COMMAND</span>
<span class="c1"># //************************************************</span>
<span class="c1"># typedef UINTN EFI_SMBUS_DEVICE_COMMAND;</span>
<span class="c1">#</span>
<span class="c1"># //************************************************</span>
<span class="c1"># // EFI_SMBUS_OPERATION</span>
<span class="c1"># //************************************************</span>
<span class="c1"># typedef enum _EFI_SMBUS_OPERATION {</span>
<span class="c1"># EfiSmbusQuickRead,</span>
<span class="c1"># EfiSmbusQuickWrite,</span>
<span class="c1"># EfiSmbusReceiveByte,</span>
<span class="c1"># EfiSmbusSendByte,</span>
<span class="c1"># EfiSmbusReadByte,</span>
<span class="c1"># EfiSmbusWriteByte,</span>
<span class="c1"># EfiSmbusReadWord,</span>
<span class="c1"># EfiSmbusWriteWord,</span>
<span class="c1"># EfiSmbusReadBlock,</span>
<span class="c1"># EfiSmbusWriteBlock,</span>
<span class="c1"># EfiSmbusProcessCall,</span>
<span class="c1"># EfiSmbusBWBRProcessCall</span>
<span class="c1"># } EFI_SMBUS_OPERATION;</span>

<span class="k">class</span> <span class="nc">S3BootScriptSmbusOperation</span><span class="p">:</span>
    <span class="n">QUICK_READ</span>        <span class="o">=</span> <span class="mh">0x00</span>
    <span class="n">QUICK_WRITE</span>       <span class="o">=</span> <span class="mh">0x01</span>
    <span class="n">RECEIVE_BYTE</span>      <span class="o">=</span> <span class="mh">0x02</span>
    <span class="n">SEND_BYTE</span>         <span class="o">=</span> <span class="mh">0x03</span>
    <span class="n">READ_BYTE</span>         <span class="o">=</span> <span class="mh">0x04</span>
    <span class="n">WRITE_BYTE</span>        <span class="o">=</span> <span class="mh">0x05</span>
    <span class="n">READ_WORD</span>         <span class="o">=</span> <span class="mh">0x06</span>
    <span class="n">WRITE_WORD</span>        <span class="o">=</span> <span class="mh">0x07</span>
    <span class="n">READ_BLOCK</span>        <span class="o">=</span> <span class="mh">0x08</span>
    <span class="n">WRITE_BLOCK</span>       <span class="o">=</span> <span class="mh">0x09</span>
    <span class="n">PROCESS_CALL</span>      <span class="o">=</span> <span class="mh">0x0A</span>
    <span class="n">BWBR_PROCESS_CALL</span> <span class="o">=</span> <span class="mh">0x0B</span>


<span class="k">class</span> <span class="nc">op_io_pci_mem</span><span class="p">():</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">opcode</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">address</span><span class="p">,</span> <span class="n">unknown</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">buffer</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">opcode</span>  <span class="o">=</span> <span class="n">opcode</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">size</span>    <span class="o">=</span> <span class="n">size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">width</span>   <span class="o">=</span> <span class="n">width</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">address</span> <span class="o">=</span> <span class="n">address</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unknown</span> <span class="o">=</span> <span class="n">unknown</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">count</span>   <span class="o">=</span> <span class="n">count</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span>   <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mask</span>    <span class="o">=</span> <span class="n">mask</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span>    <span class="o">=</span> <span class="n">script_opcodes</span><span class="p">[</span> <span class="n">opcode</span> <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">buffer</span>  <span class="o">=</span> <span class="n">buffer</span> <span class="c1"># data[ self.size : ]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">values</span>  <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">buffer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">sz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">*</span> <span class="n">script_width_sizes</span><span class="p">[</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">buffer</span><span class="p">)</span> <span class="o">!=</span> <span class="n">sz</span><span class="p">:</span>
                <span class="n">logger</span><span class="p">()</span><span class="o">.</span><span class="n">log</span><span class="p">(</span> <span class="s1">&#39;[?] buffer size (0x</span><span class="si">{:X}</span><span class="s1">) != Width x Count (0x</span><span class="si">{:X}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">buffer</span><span class="p">),</span> <span class="n">sz</span><span class="p">)</span> <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">values</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span> <span class="p">(</span><span class="s1">&#39;&lt;</span><span class="si">{:d}{:1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">count</span><span class="p">,</span> <span class="n">script_width_formats</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">])),</span> <span class="bp">self</span><span class="o">.</span><span class="n">buffer</span> <span class="p">)</span> <span class="p">)</span>
    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">str_r</span> <span class="o">=</span>  <span class="s2">&quot;  Opcode : </span><span class="si">{}</span><span class="s2"> (0x</span><span class="si">{:04X}</span><span class="s2">)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">opcode</span><span class="p">)</span>
        <span class="n">str_r</span> <span class="o">+=</span> <span class="s2">&quot;  Width  : 0x</span><span class="si">{:02X}</span><span class="s2"> (</span><span class="si">{:X}</span><span class="s2"> bytes)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="n">script_width_sizes</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">])</span>
        <span class="n">str_r</span> <span class="o">+=</span> <span class="s2">&quot;  Address: 0x</span><span class="si">{:08X}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">address</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>   <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">str_r</span> <span class="o">+=</span> <span class="s2">&quot;  Value  : 0x</span><span class="si">{:08X}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mask</span>    <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">str_r</span> <span class="o">+=</span> <span class="s2">&quot;  Mask   : 0x</span><span class="si">{:08X}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">unknown</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">str_r</span> <span class="o">+=</span> <span class="s2">&quot;  Unknown: 0x</span><span class="si">{:04X}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unknown</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">count</span>   <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">str_r</span> <span class="o">+=</span> <span class="s2">&quot;  Count  : 0x</span><span class="si">{:X}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">count</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span>  <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fmt</span> <span class="o">=</span> <span class="s1">&#39;0x</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="s1">&#39;{{:0</span><span class="si">{:d}</span><span class="s1">X}}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">script_width_sizes</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">]</span> <span class="o">*</span><span class="mi">2</span><span class="p">)</span> <span class="p">)</span>
            <span class="n">str_r</span> <span class="o">+=</span> <span class="s2">&quot;  Values : </span><span class="si">{}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;  &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="p">[</span><span class="n">fmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">]</span> <span class="p">))</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">buffer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">str_r</span> <span class="o">+=</span> <span class="p">(</span><span class="s2">&quot;  Buffer (size = 0x</span><span class="si">{:X}</span><span class="s2">):</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">buffer</span><span class="p">))</span> <span class="o">+</span> <span class="n">dump_buffer</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">buffer</span><span class="p">,</span> <span class="mi">16</span> <span class="p">))</span>
        <span class="k">return</span> <span class="n">str_r</span>


<span class="k">class</span> <span class="nc">op_smbus_execute</span><span class="p">():</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">opcode</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">address</span><span class="p">,</span> <span class="n">command</span><span class="p">,</span> <span class="n">operation</span><span class="p">,</span> <span class="n">peccheck</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">opcode</span>        <span class="o">=</span> <span class="n">opcode</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">size</span>          <span class="o">=</span> <span class="n">size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">address</span>       <span class="o">=</span> <span class="n">address</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">command</span>       <span class="o">=</span> <span class="n">command</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">operation</span>     <span class="o">=</span> <span class="n">operation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">peccheck</span>      <span class="o">=</span> <span class="n">peccheck</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span>          <span class="o">=</span> <span class="n">script_opcodes</span><span class="p">[</span> <span class="n">opcode</span> <span class="p">]</span>
    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">str_r</span> <span class="o">=</span>  <span class="s2">&quot;  Opcode           : </span><span class="si">{}</span><span class="s2"> (0x</span><span class="si">{:04X}</span><span class="s2">)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">opcode</span><span class="p">)</span>
        <span class="n">str_r</span> <span class="o">+=</span> <span class="s2">&quot;  Secondary Address: 0x</span><span class="si">{:02X}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">address</span><span class="p">)</span>
        <span class="n">str_r</span> <span class="o">+=</span> <span class="s2">&quot;  Command          : 0x</span><span class="si">{:08X}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">command</span><span class="p">)</span>
        <span class="n">str_r</span> <span class="o">+=</span> <span class="s2">&quot;  Operation        : 0x</span><span class="si">{:02X}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">operation</span><span class="p">)</span>
        <span class="n">str_r</span> <span class="o">+=</span> <span class="s2">&quot;  PEC Check        : </span><span class="si">{:d}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">peccheck</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">str_r</span>

<span class="c1">#typedef struct {</span>
<span class="c1">#  UINT16  OpCode;</span>
<span class="c1">#  UINT8   Length;</span>
<span class="c1">#  UINT64  Duration;</span>
<span class="c1">#} EFI_BOOT_SCRIPT_STALL;</span>
<span class="k">class</span> <span class="nc">op_stall</span><span class="p">():</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">opcode</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">duration</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">opcode</span>   <span class="o">=</span> <span class="n">opcode</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">size</span>     <span class="o">=</span> <span class="n">size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">duration</span> <span class="o">=</span> <span class="n">duration</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span>     <span class="o">=</span> <span class="n">script_opcodes</span><span class="p">[</span> <span class="bp">self</span><span class="o">.</span><span class="n">opcode</span> <span class="p">]</span>
    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">str_r</span> <span class="o">=</span>  <span class="s2">&quot;  Opcode  : </span><span class="si">{}</span><span class="s2"> (0x</span><span class="si">{:04X}</span><span class="s2">)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">opcode</span><span class="p">)</span>
        <span class="n">str_r</span> <span class="o">+=</span> <span class="s2">&quot;  Duration: 0x</span><span class="si">{:08X}</span><span class="s2"> (us)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">duration</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">str_r</span>

<span class="c1">#typedef struct {</span>
<span class="c1">#  UINT16                OpCode;</span>
<span class="c1">#  UINT8                 Length;</span>
<span class="c1">#  EFI_PHYSICAL_ADDRESS  EntryPoint;</span>
<span class="c1">#} EFI_BOOT_SCRIPT_DISPATCH;</span>
<span class="k">class</span> <span class="nc">op_dispatch</span><span class="p">():</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">opcode</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">entrypoint</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">opcode</span>     <span class="o">=</span> <span class="n">opcode</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">size</span>       <span class="o">=</span> <span class="n">size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entrypoint</span> <span class="o">=</span> <span class="n">entrypoint</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">context</span>    <span class="o">=</span> <span class="n">context</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span>       <span class="o">=</span> <span class="n">script_opcodes</span><span class="p">[</span> <span class="bp">self</span><span class="o">.</span><span class="n">opcode</span> <span class="p">]</span>
    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">str_r</span> <span class="o">=</span>  <span class="s2">&quot;  Opcode     : </span><span class="si">{}</span><span class="s2"> (0x</span><span class="si">{:04X}</span><span class="s2">)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">opcode</span><span class="p">)</span>
        <span class="n">str_r</span> <span class="o">+=</span> <span class="s2">&quot;  Entry Point: 0x</span><span class="si">{:016X}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">entrypoint</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">str_r</span> <span class="o">+=</span> <span class="s2">&quot;  Context    : 0x</span><span class="si">{:016X}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">str_r</span>

<span class="c1">#typedef struct {</span>
<span class="c1">#  UINT16  OpCode;</span>
<span class="c1">#  UINT8   Length;</span>
<span class="c1">#  UINT32  Width;</span>
<span class="c1">#  UINT64  Address;</span>
<span class="c1">#  UINT64  Duration;</span>
<span class="c1">#  UINT64  LoopTimes;</span>
<span class="c1">#} EFI_BOOT_SCRIPT_MEM_POLL;</span>
<span class="k">class</span> <span class="nc">op_mem_poll</span><span class="p">():</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">opcode</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">address</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span> <span class="n">looptimes</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">opcode</span>    <span class="o">=</span> <span class="n">opcode</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">size</span>      <span class="o">=</span> <span class="n">size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">width</span>     <span class="o">=</span> <span class="n">width</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">address</span>   <span class="o">=</span> <span class="n">address</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">duration</span>  <span class="o">=</span> <span class="n">duration</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">looptimes</span> <span class="o">=</span> <span class="n">looptimes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span>      <span class="o">=</span> <span class="s1">&#39;S3_BOOTSCRIPT_MEM_POLL&#39;</span>
    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">str_r</span> <span class="o">=</span>  <span class="s2">&quot;  Opcode    : </span><span class="si">{}</span><span class="s2"> (0x</span><span class="si">{:04X}</span><span class="s2">)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">opcode</span><span class="p">)</span>
        <span class="n">str_r</span> <span class="o">+=</span> <span class="s2">&quot;  Width     : 0x</span><span class="si">{:02X}</span><span class="s2"> (</span><span class="si">{:X}</span><span class="s2"> bytes)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="n">script_width_sizes</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">])</span>
        <span class="n">str_r</span> <span class="o">+=</span> <span class="s2">&quot;  Address   : 0x</span><span class="si">{:016X}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">address</span><span class="p">)</span>
        <span class="n">str_r</span> <span class="o">+=</span> <span class="s2">&quot;  Duration? : 0x</span><span class="si">{:016X}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">duration</span><span class="p">)</span>
        <span class="n">str_r</span> <span class="o">+=</span> <span class="s2">&quot;  LoopTimes?: 0x</span><span class="si">{:016X}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">looptimes</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">str_r</span>

<span class="c1">#typedef struct {</span>
<span class="c1">#  UINT16  OpCode;</span>
<span class="c1">#  UINT8   Length;</span>
<span class="c1">#} EFI_BOOT_SCRIPT_TERMINATE;</span>
<span class="k">class</span> <span class="nc">op_terminate</span><span class="p">():</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">opcode</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">opcode</span>     <span class="o">=</span> <span class="n">opcode</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">size</span>       <span class="o">=</span> <span class="n">size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span>       <span class="o">=</span> <span class="n">script_opcodes</span><span class="p">[</span> <span class="bp">self</span><span class="o">.</span><span class="n">opcode</span> <span class="p">]</span>
    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;  Opcode     : </span><span class="si">{}</span><span class="s2"> (0x</span><span class="si">{:02X}</span><span class="s2">)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">opcode</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">op_unknown</span><span class="p">():</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">opcode</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">opcode</span>     <span class="o">=</span> <span class="n">opcode</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">size</span>       <span class="o">=</span> <span class="n">size</span>
    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;  Opcode     : unknown (0x</span><span class="si">{:02X}</span><span class="s2">)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">opcode</span><span class="p">)</span>



<span class="k">class</span> <span class="nc">S3BOOTSCRIPT_ENTRY</span><span class="p">():</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">script_type</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">offset_in_script</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span> <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">script_type</span>      <span class="o">=</span> <span class="n">script_type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index</span>            <span class="o">=</span> <span class="n">index</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">offset_in_script</span> <span class="o">=</span> <span class="n">offset_in_script</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">length</span>           <span class="o">=</span> <span class="n">length</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span>             <span class="o">=</span> <span class="n">data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">decoded_opcode</span>   <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">header_length</span>    <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">entry_str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">(</span><span class="s1">&#39;[</span><span class="si">{:03d}</span><span class="s1">] &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">))</span>
        <span class="n">entry_str</span> <span class="o">+=</span> <span class="p">(</span> <span class="s1">&#39;Entry at offset 0x</span><span class="si">{:04X}</span><span class="s1"> (len = 0x</span><span class="si">{:X}</span><span class="s1">, header len = 0x</span><span class="si">{:X}</span><span class="s1">):&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">offset_in_script</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">header_length</span><span class="p">)</span> <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span> <span class="n">entry_str</span> <span class="o">=</span> <span class="n">entry_str</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Data:</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">dump_buffer_bytes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">decoded_opcode</span><span class="p">:</span> <span class="n">entry_str</span> <span class="o">=</span> <span class="n">entry_str</span> <span class="o">+</span> <span class="s1">&#39;Decoded:</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">decoded_opcode</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">entry_str</span>






<span class="c1"># #################################################################################################</span>
<span class="c1">#</span>
<span class="c1"># UEFI Table Parsing Functionality</span>
<span class="c1">#</span>
<span class="c1"># #################################################################################################</span>


<span class="n">MAX_EFI_TABLE_SIZE</span> <span class="o">=</span> <span class="mh">0x1000</span>

<span class="c1"># typedef struct {</span>
<span class="c1">#   UINT64  Signature;</span>
<span class="c1">#   UINT32  Revision;</span>
<span class="c1">#   UINT32  HeaderSize;</span>
<span class="c1">#   UINT32  CRC32;</span>
<span class="c1">#   UINT32  Reserved;</span>
<span class="c1"># } EFI_TABLE_HEADER;</span>

<span class="n">EFI_TABLE_HEADER_FMT</span>  <span class="o">=</span> <span class="s1">&#39;=8sIIII&#39;</span>
<span class="n">EFI_TABLE_HEADER_SIZE</span> <span class="o">=</span> <span class="mh">0x18</span>

<div class="viewcode-block" id="EFI_TABLE_HEADER"><a class="viewcode-back" href="../../../modules/chipsec.hal.uefi_common.html#chipsec.hal.uefi_common.EFI_TABLE_HEADER">[docs]</a><span class="k">class</span> <span class="nc">EFI_TABLE_HEADER</span><span class="p">(</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;EFI_TABLE_HEADER&#39;</span><span class="p">,</span> <span class="s1">&#39;Signature Revision HeaderSize CRC32 Reserved&#39;</span><span class="p">)</span> <span class="p">):</span>
    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">()</span>
    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;&quot;Header:</span>
<span class="s2">  Signature     : </span><span class="si">{}</span><span class="s2"></span>
<span class="s2">  Revision      : </span><span class="si">{}</span><span class="s2"></span>
<span class="s2">  HeaderSize    : 0x</span><span class="si">{:08X}</span><span class="s2"></span>
<span class="s2">  CRC32         : 0x</span><span class="si">{:08X}</span><span class="s2"></span>
<span class="s2">  Reserved      : 0x</span><span class="si">{:08X}</span><span class="s2">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="n">bytestostring</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Signature</span><span class="p">),</span> <span class="n">EFI_SYSTEM_TABLE_REVISION</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Revision</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">HeaderSize</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">CRC32</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Reserved</span> <span class="p">)</span></div>


<span class="c1"># #################################################################################################</span>
<span class="c1"># EFI System Table</span>
<span class="c1"># #################################################################################################</span>
<span class="c1">#</span>
<span class="c1"># \MdePkg\Include\Uefi\UefiSpec.h</span>

<span class="n">EFI_SYSTEM_TABLE_SIGNATURE</span>     <span class="o">=</span> <span class="s1">&#39;IBI SYST&#39;</span>

<span class="n">EFI_2_70_SYSTEM_TABLE_REVISION</span> <span class="o">=</span> <span class="p">((</span><span class="mi">2</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">70</span><span class="p">))</span>
<span class="n">EFI_2_60_SYSTEM_TABLE_REVISION</span> <span class="o">=</span> <span class="p">((</span><span class="mi">2</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">60</span><span class="p">))</span>
<span class="n">EFI_2_50_SYSTEM_TABLE_REVISION</span> <span class="o">=</span> <span class="p">((</span><span class="mi">2</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">50</span><span class="p">))</span>
<span class="n">EFI_2_40_SYSTEM_TABLE_REVISION</span> <span class="o">=</span> <span class="p">((</span><span class="mi">2</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">40</span><span class="p">))</span>
<span class="n">EFI_2_31_SYSTEM_TABLE_REVISION</span> <span class="o">=</span> <span class="p">((</span><span class="mi">2</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">31</span><span class="p">))</span>
<span class="n">EFI_2_30_SYSTEM_TABLE_REVISION</span> <span class="o">=</span> <span class="p">((</span><span class="mi">2</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">30</span><span class="p">))</span>
<span class="n">EFI_2_20_SYSTEM_TABLE_REVISION</span> <span class="o">=</span> <span class="p">((</span><span class="mi">2</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">20</span><span class="p">))</span>
<span class="n">EFI_2_10_SYSTEM_TABLE_REVISION</span> <span class="o">=</span> <span class="p">((</span><span class="mi">2</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">10</span><span class="p">))</span>
<span class="n">EFI_2_00_SYSTEM_TABLE_REVISION</span> <span class="o">=</span> <span class="p">((</span><span class="mi">2</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">00</span><span class="p">))</span>
<span class="n">EFI_1_10_SYSTEM_TABLE_REVISION</span> <span class="o">=</span> <span class="p">((</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">10</span><span class="p">))</span>
<span class="n">EFI_1_02_SYSTEM_TABLE_REVISION</span> <span class="o">=</span> <span class="p">((</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mo">0o2</span><span class="p">))</span>
<span class="n">EFI_REVISIONS</span> <span class="o">=</span> <span class="p">[</span><span class="n">EFI_2_70_SYSTEM_TABLE_REVISION</span><span class="p">,</span> <span class="n">EFI_2_60_SYSTEM_TABLE_REVISION</span><span class="p">,</span> <span class="n">EFI_2_50_SYSTEM_TABLE_REVISION</span><span class="p">,</span> <span class="n">EFI_2_40_SYSTEM_TABLE_REVISION</span><span class="p">,</span> <span class="n">EFI_2_31_SYSTEM_TABLE_REVISION</span><span class="p">,</span> <span class="n">EFI_2_30_SYSTEM_TABLE_REVISION</span><span class="p">,</span> <span class="n">EFI_2_20_SYSTEM_TABLE_REVISION</span><span class="p">,</span> <span class="n">EFI_2_10_SYSTEM_TABLE_REVISION</span><span class="p">,</span> <span class="n">EFI_2_00_SYSTEM_TABLE_REVISION</span><span class="p">,</span> <span class="n">EFI_1_10_SYSTEM_TABLE_REVISION</span><span class="p">,</span> <span class="n">EFI_1_02_SYSTEM_TABLE_REVISION</span> <span class="p">]</span>

<span class="k">def</span> <span class="nf">EFI_SYSTEM_TABLE_REVISION</span><span class="p">(</span><span class="n">revision</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="s1">&#39;</span><span class="si">{:d}</span><span class="s1">.</span><span class="si">{:d}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">revision</span><span class="o">&gt;&gt;</span><span class="mi">16</span><span class="p">,</span> <span class="n">revision</span><span class="o">&amp;</span><span class="mh">0xFFFF</span><span class="p">)</span> <span class="p">)</span>

<span class="n">EFI_SYSTEM_TABLE_FMT</span>  <span class="o">=</span> <span class="s1">&#39;=12Q&#39;</span>
<div class="viewcode-block" id="EFI_SYSTEM_TABLE"><a class="viewcode-back" href="../../../modules/chipsec.hal.uefi_common.html#chipsec.hal.uefi_common.EFI_SYSTEM_TABLE">[docs]</a><span class="k">class</span> <span class="nc">EFI_SYSTEM_TABLE</span><span class="p">(</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;EFI_SYSTEM_TABLE&#39;</span><span class="p">,</span> <span class="s1">&#39;FirmwareVendor FirmwareRevision ConsoleInHandle ConIn ConsoleOutHandle ConOut StandardErrorHandle StdErr RuntimeServices BootServices NumberOfTableEntries ConfigurationTable&#39;</span><span class="p">)</span> <span class="p">):</span>
    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">()</span>
    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;&quot;EFI System Table:</span>
<span class="s2">  FirmwareVendor      : 0x</span><span class="si">{:016X}</span><span class="s2"></span>
<span class="s2">  FirmwareRevision    : 0x</span><span class="si">{:016X}</span><span class="s2"></span>
<span class="s2">  ConsoleInHandle     : 0x</span><span class="si">{:016X}</span><span class="s2"></span>
<span class="s2">  ConIn               : 0x</span><span class="si">{:016X}</span><span class="s2"></span>
<span class="s2">  ConsoleOutHandle    : 0x</span><span class="si">{:016X}</span><span class="s2"></span>
<span class="s2">  ConOut              : 0x</span><span class="si">{:016X}</span><span class="s2"></span>
<span class="s2">  StandardErrorHandle : 0x</span><span class="si">{:016X}</span><span class="s2"></span>
<span class="s2">  StdErr              : 0x</span><span class="si">{:016X}</span><span class="s2"></span>
<span class="s2">  RuntimeServices     : 0x</span><span class="si">{:016X}</span><span class="s2"></span>
<span class="s2">  BootServices        : 0x</span><span class="si">{:016X}</span><span class="s2"></span>
<span class="s2">  NumberOfTableEntries: 0x</span><span class="si">{:016X}</span><span class="s2"></span>
<span class="s2">  ConfigurationTable  : 0x</span><span class="si">{:016X}</span><span class="s2"></span>
<span class="s2">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">FirmwareVendor</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">FirmwareRevision</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ConsoleInHandle</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ConIn</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ConsoleOutHandle</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ConOut</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">StandardErrorHandle</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">StdErr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">RuntimeServices</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">BootServices</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">NumberOfTableEntries</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ConfigurationTable</span> <span class="p">)</span></div>


<span class="c1"># #################################################################################################</span>
<span class="c1"># EFI Runtime Services Table</span>
<span class="c1"># #################################################################################################</span>
<span class="c1">#</span>
<span class="c1"># \MdePkg\Include\Uefi\UefiSpec.h</span>

<span class="n">EFI_RUNTIME_SERVICES_SIGNATURE</span>  <span class="o">=</span> <span class="s1">&#39;RUNTSERV&#39;</span>
<span class="n">EFI_RUNTIME_SERVICES_REVISION</span>   <span class="o">=</span> <span class="n">EFI_2_31_SYSTEM_TABLE_REVISION</span>

<span class="n">EFI_RUNTIME_SERVICES_TABLE_FMT</span>  <span class="o">=</span> <span class="s1">&#39;=14Q&#39;</span>

<div class="viewcode-block" id="EFI_RUNTIME_SERVICES_TABLE"><a class="viewcode-back" href="../../../modules/chipsec.hal.uefi_common.html#chipsec.hal.uefi_common.EFI_RUNTIME_SERVICES_TABLE">[docs]</a><span class="k">class</span> <span class="nc">EFI_RUNTIME_SERVICES_TABLE</span><span class="p">(</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;EFI_RUNTIME_SERVICES_TABLE&#39;</span><span class="p">,</span> <span class="s1">&#39;GetTime SetTime GetWakeupTime SetWakeupTime SetVirtualAddressMap ConvertPointer GetVariable GetNextVariableName SetVariable GetNextHighMonotonicCount ResetSystem UpdateCapsule QueryCapsuleCapabilities QueryVariableInfo&#39;</span><span class="p">)</span> <span class="p">):</span>
    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">()</span>
    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;&quot;Runtime Services:</span>
<span class="s2">  GetTime                  : 0x</span><span class="si">{:016X}</span><span class="s2"></span>
<span class="s2">  SetTime                  : 0x</span><span class="si">{:016X}</span><span class="s2"></span>
<span class="s2">  GetWakeupTime            : 0x</span><span class="si">{:016X}</span><span class="s2"></span>
<span class="s2">  SetWakeupTime            : 0x</span><span class="si">{:016X}</span><span class="s2"></span>
<span class="s2">  SetVirtualAddressMap     : 0x</span><span class="si">{:016X}</span><span class="s2"></span>
<span class="s2">  ConvertPointer           : 0x</span><span class="si">{:016X}</span><span class="s2"></span>
<span class="s2">  GetVariable              : 0x</span><span class="si">{:016X}</span><span class="s2"></span>
<span class="s2">  GetNextVariableName      : 0x</span><span class="si">{:016X}</span><span class="s2"></span>
<span class="s2">  SetVariable              : 0x</span><span class="si">{:016X}</span><span class="s2"></span>
<span class="s2">  GetNextHighMonotonicCount: 0x</span><span class="si">{:016X}</span><span class="s2"></span>
<span class="s2">  ResetSystem              : 0x</span><span class="si">{:016X}</span><span class="s2"></span>
<span class="s2">  UpdateCapsule            : 0x</span><span class="si">{:016X}</span><span class="s2"></span>
<span class="s2">  QueryCapsuleCapabilities : 0x</span><span class="si">{:016X}</span><span class="s2"></span>
<span class="s2">  QueryVariableInfo        : 0x</span><span class="si">{:016X}</span><span class="s2"></span>
<span class="s2">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetTime</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">SetTime</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetWakeupTime</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">SetWakeupTime</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">SetVirtualAddressMap</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ConvertPointer</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetVariable</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetNextVariableName</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">SetVariable</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetNextHighMonotonicCount</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ResetSystem</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">UpdateCapsule</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">QueryCapsuleCapabilities</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">QueryVariableInfo</span> <span class="p">)</span></div>


<span class="c1"># #################################################################################################</span>
<span class="c1"># EFI Boot Services Table</span>
<span class="c1"># #################################################################################################</span>
<span class="c1">#</span>
<span class="c1"># \MdePkg\Include\Uefi\UefiSpec.h</span>

<span class="n">EFI_BOOT_SERVICES_SIGNATURE</span> <span class="o">=</span> <span class="s1">&#39;BOOTSERV&#39;</span>
<span class="n">EFI_BOOT_SERVICES_REVISION</span>  <span class="o">=</span> <span class="n">EFI_2_31_SYSTEM_TABLE_REVISION</span>

<span class="n">EFI_BOOT_SERVICES_TABLE_FMT</span>  <span class="o">=</span> <span class="s1">&#39;=44Q&#39;</span>

<div class="viewcode-block" id="EFI_BOOT_SERVICES_TABLE"><a class="viewcode-back" href="../../../modules/chipsec.hal.uefi_common.html#chipsec.hal.uefi_common.EFI_BOOT_SERVICES_TABLE">[docs]</a><span class="k">class</span> <span class="nc">EFI_BOOT_SERVICES_TABLE</span><span class="p">(</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;EFI_BOOT_SERVICES_TABLE&#39;</span><span class="p">,</span> <span class="s1">&#39;RaiseTPL RestoreTPL AllocatePages FreePages GetMemoryMap AllocatePool FreePool CreateEvent SetTimer WaitForEvent SignalEvent CloseEvent CheckEvent InstallProtocolInterface ReinstallProtocolInterface UninstallProtocolInterface HandleProtocol Reserved RegisterProtocolNotify LocateHandle LocateDevicePath InstallConfigurationTable LoadImage StartImage Exit UnloadImage ExitBootServices GetNextMonotonicCount Stall SetWatchdogTimer ConnectController DisconnectController OpenProtocol CloseProtocol OpenProtocolInformation ProtocolsPerHandle LocateHandleBuffer LocateProtocol InstallMultipleProtocolInterfaces UninstallMultipleProtocolInterfaces CalculateCrc32 CopyMem SetMem CreateEventEx&#39;</span><span class="p">)</span> <span class="p">):</span>
    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">()</span>
    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;&quot;Boot Services:</span>
<span class="s2">  RaiseTPL                           : 0x</span><span class="si">{:016X}</span><span class="s2"></span>
<span class="s2">  RestoreTPL                         : 0x</span><span class="si">{:016X}</span><span class="s2"></span>
<span class="s2">  AllocatePages                      : 0x</span><span class="si">{:016X}</span><span class="s2"></span>
<span class="s2">  FreePages                          : 0x</span><span class="si">{:016X}</span><span class="s2"></span>
<span class="s2">  GetMemoryMap                       : 0x</span><span class="si">{:016X}</span><span class="s2"></span>
<span class="s2">  AllocatePool                       : 0x</span><span class="si">{:016X}</span><span class="s2"></span>
<span class="s2">  FreePool                           : 0x</span><span class="si">{:016X}</span><span class="s2"></span>
<span class="s2">  CreateEvent                        : 0x</span><span class="si">{:016X}</span><span class="s2"></span>
<span class="s2">  SetTimer                           : 0x</span><span class="si">{:016X}</span><span class="s2"></span>
<span class="s2">  WaitForEvent                       : 0x</span><span class="si">{:016X}</span><span class="s2"></span>
<span class="s2">  SignalEvent                        : 0x</span><span class="si">{:016X}</span><span class="s2"></span>
<span class="s2">  CloseEvent                         : 0x</span><span class="si">{:016X}</span><span class="s2"></span>
<span class="s2">  CheckEvent                         : 0x</span><span class="si">{:016X}</span><span class="s2"></span>
<span class="s2">  InstallProtocolInterface           : 0x</span><span class="si">{:016X}</span><span class="s2"></span>
<span class="s2">  ReinstallProtocolInterface         : 0x</span><span class="si">{:016X}</span><span class="s2"></span>
<span class="s2">  UninstallProtocolInterface         : 0x</span><span class="si">{:016X}</span><span class="s2"></span>
<span class="s2">  HandleProtocol                     : 0x</span><span class="si">{:016X}</span><span class="s2"></span>
<span class="s2">  Reserved                           : 0x</span><span class="si">{:016X}</span><span class="s2"></span>
<span class="s2">  RegisterProtocolNotify             : 0x</span><span class="si">{:016X}</span><span class="s2"></span>
<span class="s2">  LocateHandle                       : 0x</span><span class="si">{:016X}</span><span class="s2"></span>
<span class="s2">  LocateDevicePath                   : 0x</span><span class="si">{:016X}</span><span class="s2"></span>
<span class="s2">  InstallConfigurationTable          : 0x</span><span class="si">{:016X}</span><span class="s2"></span>
<span class="s2">  LoadImage                          : 0x</span><span class="si">{:016X}</span><span class="s2"></span>
<span class="s2">  StartImage                         : 0x</span><span class="si">{:016X}</span><span class="s2"></span>
<span class="s2">  Exit                               : 0x</span><span class="si">{:016X}</span><span class="s2"></span>
<span class="s2">  UnloadImage                        : 0x</span><span class="si">{:016X}</span><span class="s2"></span>
<span class="s2">  ExitBootServices                   : 0x</span><span class="si">{:016X}</span><span class="s2"></span>
<span class="s2">  GetNextMonotonicCount              : 0x</span><span class="si">{:016X}</span><span class="s2"></span>
<span class="s2">  Stall                              : 0x</span><span class="si">{:016X}</span><span class="s2"></span>
<span class="s2">  SetWatchdogTimer                   : 0x</span><span class="si">{:016X}</span><span class="s2"></span>
<span class="s2">  ConnectController                  : 0x</span><span class="si">{:016X}</span><span class="s2"></span>
<span class="s2">  DisconnectController               : 0x</span><span class="si">{:016X}</span><span class="s2"></span>
<span class="s2">  OpenProtocol                       : 0x</span><span class="si">{:016X}</span><span class="s2"></span>
<span class="s2">  CloseProtocol                      : 0x</span><span class="si">{:016X}</span><span class="s2"></span>
<span class="s2">  OpenProtocolInformation            : 0x</span><span class="si">{:016X}</span><span class="s2"></span>
<span class="s2">  ProtocolsPerHandle                 : 0x</span><span class="si">{:016X}</span><span class="s2"></span>
<span class="s2">  LocateHandleBuffer                 : 0x</span><span class="si">{:016X}</span><span class="s2"></span>
<span class="s2">  LocateProtocol                     : 0x</span><span class="si">{:016X}</span><span class="s2"></span>
<span class="s2">  InstallMultipleProtocolInterfaces  : 0x</span><span class="si">{:016X}</span><span class="s2"></span>
<span class="s2">  UninstallMultipleProtocolInterfaces: 0x</span><span class="si">{:016X}</span><span class="s2"></span>
<span class="s2">  CalculateCrc32                     : 0x</span><span class="si">{:016X}</span><span class="s2"></span>
<span class="s2">  CopyMem                            : 0x</span><span class="si">{:016X}</span><span class="s2"></span>
<span class="s2">  SetMem                             : 0x</span><span class="si">{:016X}</span><span class="s2"></span>
<span class="s2">  CreateEventEx                      : 0x</span><span class="si">{:016X}</span><span class="s2"></span>
<span class="s2">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">RaiseTPL</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">RestoreTPL</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">AllocatePages</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">FreePages</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetMemoryMap</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">AllocatePool</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">FreePool</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">CreateEvent</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">SetTimer</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">WaitForEvent</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">SignalEvent</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">CloseEvent</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">CheckEvent</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">InstallProtocolInterface</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ReinstallProtocolInterface</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">UninstallProtocolInterface</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">HandleProtocol</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Reserved</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">RegisterProtocolNotify</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">LocateHandle</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">LocateDevicePath</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">InstallConfigurationTable</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">LoadImage</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">StartImage</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Exit</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">UnloadImage</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ExitBootServices</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetNextMonotonicCount</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Stall</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">SetWatchdogTimer</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ConnectController</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">DisconnectController</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">OpenProtocol</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">CloseProtocol</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">OpenProtocolInformation</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ProtocolsPerHandle</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">LocateHandleBuffer</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">LocateProtocol</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">InstallMultipleProtocolInterfaces</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">UninstallMultipleProtocolInterfaces</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">CalculateCrc32</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">CopyMem</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">SetMem</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">CreateEventEx</span> <span class="p">)</span></div>


<span class="c1"># #################################################################################################</span>
<span class="c1"># EFI System Configuration Table</span>
<span class="c1"># #################################################################################################</span>
<span class="c1">#</span>
<span class="c1"># \MdePkg\Include\Uefi\UefiSpec.h</span>
<span class="c1"># -------------------------------</span>

<span class="n">EFI_VENDOR_TABLE_FORMAT</span> <span class="o">=</span> <span class="s1">&#39;&lt;&#39;</span> <span class="o">+</span> <span class="n">EFI_GUID_FMT</span> <span class="o">+</span> <span class="s1">&#39;Q&#39;</span>
<span class="n">EFI_VENDOR_TABLE_SIZE</span>   <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">calcsize</span><span class="p">(</span><span class="n">EFI_VENDOR_TABLE_FORMAT</span><span class="p">)</span>

<div class="viewcode-block" id="EFI_VENDOR_TABLE"><a class="viewcode-back" href="../../../modules/chipsec.hal.uefi_common.html#chipsec.hal.uefi_common.EFI_VENDOR_TABLE">[docs]</a><span class="k">class</span> <span class="nc">EFI_VENDOR_TABLE</span><span class="p">(</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;EFI_VENDOR_TABLE&#39;</span><span class="p">,</span> <span class="s1">&#39;VendorGuidData VendorTable&#39;</span><span class="p">)</span> <span class="p">):</span>
    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">()</span>
    <span class="k">def</span> <span class="nf">VendorGuid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">EFI_GUID_STR</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">VendorGuidData</span><span class="p">)</span></div>

<span class="k">class</span> <span class="nc">EFI_CONFIGURATION_TABLE</span><span class="p">():</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">VendorTables</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span> <span class="s1">&#39;Vendor Tables:</span><span class="se">\n</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="p">[</span><span class="s1">&#39;{{</span><span class="si">{}</span><span class="s1">}} : 0x</span><span class="si">{:016X}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">vt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">VendorTables</span><span class="p">[</span><span class="n">vt</span><span class="p">])</span> <span class="k">for</span> <span class="n">vt</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">VendorTables</span><span class="p">]))</span> <span class="p">)</span>


<span class="c1"># #################################################################################################</span>
<span class="c1"># EFI DXE Services Table</span>
<span class="c1"># #################################################################################################</span>
<span class="c1">#</span>
<span class="c1"># \MdePkg\Include\Pi\PiDxeCis.h</span>
<span class="c1"># -----------------------------</span>
<span class="c1">#</span>
<span class="n">EFI_DXE_SERVICES_TABLE_SIGNATURE</span>  <span class="o">=</span> <span class="s1">&#39;DXE_SERV&#39;</span> <span class="c1"># 0x565245535f455844</span>
<span class="n">EFI_DXE_SERVICES_TABLE_FMT</span>        <span class="o">=</span> <span class="s1">&#39;=17Q&#39;</span>
<div class="viewcode-block" id="EFI_DXE_SERVICES_TABLE"><a class="viewcode-back" href="../../../modules/chipsec.hal.uefi_common.html#chipsec.hal.uefi_common.EFI_DXE_SERVICES_TABLE">[docs]</a><span class="k">class</span> <span class="nc">EFI_DXE_SERVICES_TABLE</span><span class="p">(</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;EFI_DXE_SERVICES_TABLE&#39;</span><span class="p">,</span> <span class="s1">&#39;AddMemorySpace AllocateMemorySpace FreeMemorySpace RemoveMemorySpace GetMemorySpaceDescriptor SetMemorySpaceAttributes GetMemorySpaceMap AddIoSpace AllocateIoSpace FreeIoSpace RemoveIoSpace GetIoSpaceDescriptor GetIoSpaceMap Dispatch Schedule Trust ProcessFirmwareVolume&#39;</span><span class="p">)</span> <span class="p">):</span>
    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">()</span>
    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;&quot;DXE Services:</span>
<span class="s2">  AddMemorySpace          : 0x</span><span class="si">{:016X}</span><span class="s2"></span>
<span class="s2">  AllocateMemorySpace     : 0x</span><span class="si">{:016X}</span><span class="s2"></span>
<span class="s2">  FreeMemorySpace         : 0x</span><span class="si">{:016X}</span><span class="s2"></span>
<span class="s2">  RemoveMemorySpace       : 0x</span><span class="si">{:016X}</span><span class="s2"></span>
<span class="s2">  GetMemorySpaceDescriptor: 0x</span><span class="si">{:016X}</span><span class="s2"></span>
<span class="s2">  SetMemorySpaceAttributes: 0x</span><span class="si">{:016X}</span><span class="s2"></span>
<span class="s2">  GetMemorySpaceMap       : 0x</span><span class="si">{:016X}</span><span class="s2"></span>
<span class="s2">  AddIoSpace              : 0x</span><span class="si">{:016X}</span><span class="s2"></span>
<span class="s2">  AllocateIoSpace         : 0x</span><span class="si">{:016X}</span><span class="s2"></span>
<span class="s2">  FreeIoSpace             : 0x</span><span class="si">{:016X}</span><span class="s2"></span>
<span class="s2">  RemoveIoSpace           : 0x</span><span class="si">{:016X}</span><span class="s2"></span>
<span class="s2">  GetIoSpaceDescriptor    : 0x</span><span class="si">{:016X}</span><span class="s2"></span>
<span class="s2">  GetIoSpaceMap           : 0x</span><span class="si">{:016X}</span><span class="s2"></span>
<span class="s2">  Dispatch                : 0x</span><span class="si">{:016X}</span><span class="s2"></span>
<span class="s2">  Schedule                : 0x</span><span class="si">{:016X}</span><span class="s2"></span>
<span class="s2">  Trust                   : 0x</span><span class="si">{:016X}</span><span class="s2"></span>
<span class="s2">  ProcessFirmwareVolume   : 0x</span><span class="si">{:016X}</span><span class="s2"></span>
<span class="s2">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">AddMemorySpace</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">AllocateMemorySpace</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">FreeMemorySpace</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">RemoveMemorySpace</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetMemorySpaceDescriptor</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">SetMemorySpaceAttributes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetMemorySpaceMap</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">AddIoSpace</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">AllocateIoSpace</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">FreeIoSpace</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">RemoveIoSpace</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetIoSpaceDescriptor</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetIoSpaceMap</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Dispatch</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Schedule</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Trust</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ProcessFirmwareVolume</span> <span class="p">)</span></div>



<span class="c1"># #################################################################################################</span>
<span class="c1"># EFI PEI Services Table</span>
<span class="c1"># #################################################################################################</span>

<span class="n">EFI_FRAMEWORK_PEI_SERVICES_TABLE_SIGNATURE</span> <span class="o">=</span> <span class="mh">0x5652455320494550</span>
<span class="n">FRAMEWORK_PEI_SPECIFICATION_MAJOR_REVISION</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">FRAMEWORK_PEI_SPECIFICATION_MINOR_REVISION</span> <span class="o">=</span> <span class="mi">91</span>
<span class="n">FRAMEWORK_PEI_SERVICES_REVISION</span>            <span class="o">=</span> <span class="p">((</span><span class="n">FRAMEWORK_PEI_SPECIFICATION_MAJOR_REVISION</span><span class="o">&lt;&lt;</span><span class="mi">16</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">FRAMEWORK_PEI_SPECIFICATION_MINOR_REVISION</span><span class="p">))</span>

<span class="c1"># #################################################################################################</span>
<span class="c1"># EFI System Management System Table</span>
<span class="c1"># #################################################################################################</span>

<span class="n">EFI_SMM_SYSTEM_TABLE_SIGNATURE</span> <span class="o">=</span> <span class="s1">&#39;SMST&#39;</span>
<span class="n">EFI_SMM_SYSTEM_TABLE_REVISION</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mh">0x09</span><span class="p">)</span>




<span class="n">EFI_TABLES</span> <span class="o">=</span> <span class="p">{</span>
  <span class="n">EFI_SYSTEM_TABLE_SIGNATURE</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;EFI System Table&#39;</span><span class="p">,</span>                 <span class="s1">&#39;struct&#39;</span><span class="p">:</span> <span class="n">EFI_SYSTEM_TABLE</span><span class="p">,</span>                 <span class="s1">&#39;fmt&#39;</span><span class="p">:</span> <span class="n">EFI_SYSTEM_TABLE_FMT</span>                 <span class="p">},</span>
  <span class="n">EFI_RUNTIME_SERVICES_SIGNATURE</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;EFI Runtime Services Table&#39;</span><span class="p">,</span>       <span class="s1">&#39;struct&#39;</span><span class="p">:</span> <span class="n">EFI_RUNTIME_SERVICES_TABLE</span><span class="p">,</span>       <span class="s1">&#39;fmt&#39;</span><span class="p">:</span> <span class="n">EFI_RUNTIME_SERVICES_TABLE_FMT</span>       <span class="p">},</span>
  <span class="n">EFI_BOOT_SERVICES_SIGNATURE</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;EFI Boot Services Table&#39;</span><span class="p">,</span>          <span class="s1">&#39;struct&#39;</span><span class="p">:</span> <span class="n">EFI_BOOT_SERVICES_TABLE</span><span class="p">,</span>          <span class="s1">&#39;fmt&#39;</span><span class="p">:</span> <span class="n">EFI_BOOT_SERVICES_TABLE_FMT</span>          <span class="p">},</span>
  <span class="n">EFI_DXE_SERVICES_TABLE_SIGNATURE</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;EFI DXE Services Table&#39;</span><span class="p">,</span>           <span class="s1">&#39;struct&#39;</span><span class="p">:</span> <span class="n">EFI_DXE_SERVICES_TABLE</span><span class="p">,</span>           <span class="s1">&#39;fmt&#39;</span><span class="p">:</span> <span class="n">EFI_DXE_SERVICES_TABLE_FMT</span>           <span class="p">}</span>
  <span class="c1">#EFI_FRAMEWORK_PEI_SERVICES_TABLE_SIGNATURE : {&#39;name&#39; : &#39;EFI Framework PEI Services Table&#39;, &#39;struct&#39; : EFI_FRAMEWORK_PEI_SERVICES_TABLE, &#39;fmt&#39; : EFI_FRAMEWORK_PEI_SERVICES_TABLE_FMT },</span>
  <span class="c1">#EFI_SMM_SYSTEM_TABLE_SIGNATURE             : {&#39;name&#39; : &#39;EFI SMM System Table&#39;,             &#39;struct&#39; : EFI_SMM_SYSTEM_TABLE,             &#39;fmt&#39; : EFI_SMM_SYSTEM_TABLE_FMT             },</span>
  <span class="c1">#EFI_CONFIG_TABLE_SIGNATURE                 : {&#39;name&#39; : &#39;EFI Configuration Table&#39;,          &#39;struct&#39; : EFI_CONFIG_TABLE,                 &#39;fmt&#39; : EFI_CONFIG_TABLE_FMT                 }</span>
<span class="p">}</span>
</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../_static/chipsec_logo_transparent.png" alt="Logo"/>
            </a></p>
<h3><a href="../../../index.html">Table of Contents</a></h3>
<p class="caption"><span class="caption-text">Start here</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../Download.html">Download CHIPSEC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Contact.html">Contact</a></li>
</ul>
<p class="caption"><span class="caption-text">Installation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../Install%20in%20Windows.html">Windows Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Install%20in%20DAL%20Win.html">DAL Windows Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Install%20in%20Linux.html">Linux Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Install%20in%20MacOS.html">MacOS Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../USB%20with%20UEFI%20Shell.html">Building a Bootable USB drive with UEFI Shell (x64)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Using-CHIPSEC-with-Kali-Linux.html">Creating the Kali Linux Live USB</a></li>
</ul>
<p class="caption"><span class="caption-text">Using CHIPSEC</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../Running-Chipsec.html">Running CHIPSEC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Interpreting-Results.html">Interpreting results</a></li>
</ul>
<p class="caption"><span class="caption-text">Architecture and Modules</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../Architecture-Overview.html">Architecture Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Vulnerabilities-and-CHIPSEC-Modules.html">CHIPSEC Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Developing.html">Writing Your Own Modules</a></li>
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">CHIPSEC  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">chipsec.hal.uefi_common</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
      Last updated on Aug 31, 2021.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 3.4.3.
    </div>
  </body>
</html>